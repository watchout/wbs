# Test Strategy - ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: ãƒŸã‚¨ãƒ«ãƒœãƒ¼ãƒ‰ for ç¾å ´ / ç¾å ´WEEK  
**æœ€çµ‚æ›´æ–°**: 2025-12-07

---

## ğŸ¯ ç›®çš„

ã€Œã©ã“ã¾ã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã‹ã€ã‚’æ˜ç¢ºã«ã—ã€**äº‹æ¥­ãƒªã‚¹ã‚¯ãŒé«˜ã„å±¤**ã«é›†ä¸­çš„ã«ãƒ†ã‚¹ãƒˆã‚’é…ç½®ã—ã¾ã™ã€‚

---

## ğŸ“Š ãƒ†ã‚¹ãƒˆå„ªå…ˆåº¦ãƒãƒˆãƒªã‚¯ã‚¹

### ğŸ”´ å¿…é ˆãƒ¬ãƒ™ãƒ«ï¼ˆãƒ†ã‚¹ãƒˆå¿…é ˆï¼‰

**ãƒ“ã‚¸ãƒã‚¹ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªé ˜åŸŸ = ãƒã‚°ãŒç›´æ¥äº‹æ¥­ãƒªã‚¹ã‚¯ã«ãªã‚‹ç®‡æ‰€**

| é ˜åŸŸ | ç†ç”± | ãƒ†ã‚¹ãƒˆç¨®åˆ¥ |
|------|------|-----------|
| **èªè¨¼ãƒ»èªå¯** | ä»–ãƒ†ãƒŠãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿æ¼æ´©ãƒªã‚¹ã‚¯ | ãƒ¦ãƒ‹ãƒƒãƒˆ + E2E |
| **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¢ƒç•Œ** | organizationIdåˆ†é›¢ã®ç ´ç¶» = è‡´å‘½çš„ | ãƒ¦ãƒ‹ãƒƒãƒˆ + çµ±åˆ |
| **é‡‘éŠ­è¨ˆç®—ãƒ»ãƒ—ãƒ©ãƒ³åˆ¤å®š** | èª²é‡‘ãƒŸã‚¹ = ä¿¡é ¼å–ªå¤± | ãƒ¦ãƒ‹ãƒƒãƒˆ |
| **Schedule CRUD** | ã‚³ã‚¢ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ | çµ±åˆãƒ†ã‚¹ãƒˆ |

#### å…·ä½“ä¾‹

```typescript
// âœ… å¿…é ˆ: ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¢ƒç•Œãƒã‚§ãƒƒã‚¯
describe('GET /api/schedules', () => {
  it('should return only schedules for the authenticated organization', async () => {
    // ãƒ†ãƒŠãƒ³ãƒˆAã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³
    const responseA = await getSchedules(userA);
    expect(responseA.every(s => s.organizationId === 'org-a')).toBe(true);
    
    // ãƒ†ãƒŠãƒ³ãƒˆBã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå«ã¾ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª
    expect(responseA.some(s => s.organizationId === 'org-b')).toBe(false);
  });
});
```

---

### ğŸŸ¡ æ¨å¥¨ãƒ¬ãƒ™ãƒ«ï¼ˆã‚ã‚Œã°ãƒ™ã‚¿ãƒ¼ï¼‰

**ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ or å°†æ¥ã®å¤‰æ›´ãŒå¤šãã†ãªç®‡æ‰€**

| é ˜åŸŸ | ãƒ†ã‚¹ãƒˆç¨®åˆ¥ |
|------|-----------|
| **ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼** (scheduleFormatter.ts ãªã©) | ãƒ¦ãƒ‹ãƒƒãƒˆ |
| **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³** (å…¥åŠ›æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯) | ãƒ¦ãƒ‹ãƒƒãƒˆ |
| **UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** (Pureé–¢æ•°çš„ãªéƒ¨åˆ†) | ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ |
| **Socket.IO ã‚¤ãƒ™ãƒ³ãƒˆ** | çµ±åˆãƒ†ã‚¹ãƒˆ |

---

### ğŸŸ¢ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆæ™‚é–“ãŒã‚ã‚Œã°ï¼‰

| é ˜åŸŸ | å‚™è€ƒ |
|------|------|
| **é™çš„ãƒšãƒ¼ã‚¸** | ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã‚Œãƒã‚§ãƒƒã‚¯ç¨‹åº¦ |
| **å‹å®šç¾©ã®ã¿ã®ãƒ•ã‚¡ã‚¤ãƒ«** | TypeScriptã§æ‹…ä¿æ¸ˆã¿ |

---

## ğŸ› ï¸ ãƒ†ã‚¹ãƒˆç¨®åˆ¥ã”ã¨ã®æ–¹é‡

### 1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆVitestï¼‰

**å¯¾è±¡**: ç´”ç²‹é–¢æ•°ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯

```typescript
// server/utils/scheduleFormatter.test.ts
import { formatScheduleForDisplay } from './scheduleFormatter';

describe('scheduleFormatter', () => {
  it('should format schedule with time and site name', () => {
    const result = formatScheduleForDisplay({
      start: '2025-01-15T09:00:00Z',
      end: '2025-01-15T18:00:00Z',
      metadata: { siteName: 'â—¯â—¯ãƒ›ãƒ†ãƒ«', activityType: 'å·¥äº‹' }
    });
    
    expect(result).toBe('9-18 â—¯â—¯ãƒ›ãƒ†ãƒ« å·¥äº‹');
  });
});
```

---

### 2. çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆAPIï¼‰

**å¯¾è±¡**: API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆèªè¨¼ãƒ»DBå«ã‚€ï¼‰

```typescript
// server/api/schedules/index.test.ts
import { createTestContext } from '~/tests/helpers';

describe('POST /api/schedules', () => {
  it('should create schedule with organizationId from auth context', async () => {
    const { user, orgId } = await createTestContext();
    
    const response = await $fetch('/api/schedules', {
      method: 'POST',
      body: { start: '2025-01-15T09:00:00Z', ... },
      headers: { Authorization: `Bearer ${user.token}` }
    });
    
    expect(response.organizationId).toBe(orgId);
  });
});
```

---

### 3. E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywright - Phase 1ä»¥é™ï¼‰

**å¯¾è±¡**: ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼

- ãƒ­ã‚°ã‚¤ãƒ³ â†’ é€±é–“ãƒœãƒ¼ãƒ‰è¡¨ç¤º â†’ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ 
- ä»–ãƒ†ãƒŠãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ãˆãªã„ã“ã¨ã®ç¢ºèª

---

## ğŸ“ ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ãƒ«ãƒ¼ãƒ«

```
server/
  api/
    schedules/
      index.get.ts
      index.get.test.ts  â† APIæ¨ªã«é…ç½®
  utils/
    scheduleFormatter.ts
    scheduleFormatter.test.ts  â† ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£æ¨ªã«é…ç½®

components/
  WeeklyScheduleBoard.vue
  WeeklyScheduleBoard.test.ts  â† ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ¨ªã«é…ç½®
```

---

## âœ… Definition of "Tested"ï¼ˆãƒ†ã‚¹ãƒˆæ¸ˆã¿ã®å®šç¾©ï¼‰

ä»¥ä¸‹ã‚’æº€ãŸã™ã‚‚ã®ã‚’ã€Œãƒ†ã‚¹ãƒˆæ¸ˆã¿ã€ã¨ã¿ãªã—ã¾ã™ï¼š

- [ ] **å¿…é ˆãƒ¬ãƒ™ãƒ«**ã®æ©Ÿèƒ½ã«ã¯ãƒ†ã‚¹ãƒˆãŒã‚ã‚‹
- [ ] `npm run test` ãŒã‚°ãƒªãƒ¼ãƒ³
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä¸»è¦ãƒ­ã‚¸ãƒƒã‚¯ã§80%ä»¥ä¸Šï¼ˆç›®å®‰ï¼‰
- [ ] PRã«ã€Œã©ã®ãƒ†ã‚¹ãƒˆã§ä½•ã‚’æ¤œè¨¼ã—ãŸã‹ã€ã‚’è¨˜è¼‰

---

## ğŸš€ æ®µéšçš„å°å…¥ãƒ—ãƒ©ãƒ³

### Phase 0ï¼ˆç¾åœ¨ï¼‰
- èªè¨¼ãƒ»ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¢ƒç•Œã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆæ•´å‚™

### Phase 1
- Schedule CRUD ã®çµ±åˆãƒ†ã‚¹ãƒˆè¿½åŠ 
- ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

### Phase 2
- E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰å°å…¥
- CIã«ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆè¿½åŠ 

---

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `vitest.config.ts` - Vitestè¨­å®š
- `.github/workflows/ci.yml` - CIå®Ÿè¡Œè¨­å®š
- `docs/DONE_DEFINITION.md` - ãƒ†ã‚¹ãƒˆå®Œäº†ã®åŸºæº–






