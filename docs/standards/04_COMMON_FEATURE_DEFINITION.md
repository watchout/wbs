# 04_COMMON_FEATURE_DEFINITION.md - 共通機能の定義

> 77項目の標準機能を「共通機能」と「固有機能」に分類する基準

---

## 共通機能の定義

### 定義

**共通機能（Common Feature）** とは、以下の条件を**全て満たす**機能：

1. **普遍性**: 95%以上のWebアプリケーションで必要
2. **標準性**: 業界で確立されたベストプラクティスが存在
3. **安定性**: プロジェクトごとの差異が小さい（カスタマイズ箇所が限定的）
4. **再利用性**: 仕様書をコピーしてそのまま、または軽微な変更で使用可能

### 判定フロー

```
その機能は95%のWebアプリで必要か？
├─ No → 固有機能
└─ Yes ↓

業界標準のベストプラクティスがあるか？
├─ No → 固有機能
└─ Yes ↓

プロジェクトごとの差異は小さいか？
├─ No（大幅に異なる）→ 固有機能
└─ Yes（UIテキスト・フィールド追加程度）↓

→ 共通機能
```

---

## 77項目の分類

### 分類基準

| 分類 | 記号 | 意味 | 仕様書 |
|------|------|------|--------|
| 共通機能（確定） | ✅ | 完成済み仕様書を提供 | common-features/ |
| 共通機能（候補） | 🔶 | 仕様書作成予定 | 未作成 |
| 固有機能 | ⚪ | プロジェクトごとに作成 | project-features/ |
| 対象外 | ➖ | 本フレームワーク対象外 | - |

---

## カテゴリ別分類

### 1. 認証・認可（AUTH）- 12項目

| ID | 機能名 | 分類 | 理由 |
|----|-------|------|------|
| AUTH-001 | メール/パスワードログイン | ✅ 共通 | 全アプリ共通、OAuth2/JWTが標準 |
| AUTH-002 | OAuth（Google） | ✅ 共通 | OAuth2.0標準、実装パターン確立 |
| AUTH-003 | OAuth（GitHub） | 🔶 共通候補 | 同上 |
| AUTH-004 | OAuth（Apple） | 🔶 共通候補 | 同上 |
| AUTH-005 | ログアウト | ✅ 共通 | 全アプリ共通、パターン単純 |
| AUTH-006 | パスワードリセット | ✅ 共通 | 全アプリ共通、フロー確立 |
| AUTH-007 | メール認証 | 🔶 共通候補 | 全アプリ共通 |
| AUTH-008 | 多要素認証（MFA） | 🔶 共通候補 | TOTP標準あり、ただし導入率は低め |
| AUTH-009 | セッション一覧・管理 | 🔶 共通候補 | パターン確立 |
| AUTH-010 | トークンリフレッシュ | ✅ 共通 | JWT標準、パターン単純 |
| AUTH-011 | ソーシャル連携・解除 | 🔶 共通候補 | OAuth標準 |
| AUTH-012 | 「次回から自動ログイン」 | ✅ 共通 | AUTH-001に含む |

**共通機能率**: 10/12（83%）

---

### 2. アカウント（ACCT）- 6項目

| ID | 機能名 | 分類 | 理由 |
|----|-------|------|------|
| ACCT-001 | サインアップ | ✅ 共通 | 全アプリ共通（フィールドはカスタマイズ） |
| ACCT-002 | プロフィール表示 | 🔶 共通候補 | 全アプリ共通（フィールドはカスタマイズ） |
| ACCT-003 | プロフィール編集 | 🔶 共通候補 | 同上 |
| ACCT-004 | メールアドレス変更 | 🔶 共通候補 | パターン確立 |
| ACCT-005 | パスワード変更 | 🔶 共通候補 | パターン確立 |
| ACCT-006 | アカウント削除（退会） | 🔶 共通候補 | GDPR等で必須化傾向 |

**共通機能率**: 6/6（100%）

---

### 3. 権限・ロール（ROLE）- 5項目

| ID | 機能名 | 分類 | 理由 |
|----|-------|------|------|
| ROLE-001 | ロール定義 | ⚪ 固有 | プロジェクトごとにロール体系が異なる |
| ROLE-002 | ロール割り当て | ⚪ 固有 | 同上 |
| ROLE-003 | 権限チェック | 🔶 共通候補 | RBAC標準あり（ロール定義は固有） |
| ROLE-004 | 権限エラー表示 | ✅ 共通 | 403ページとして共通化可能 |
| ROLE-005 | 動的権限変更 | ⚪ 固有 | 要件がプロジェクトで大きく異なる |

**共通機能率**: 2/5（40%）

---

### 4. ナビゲーション（NAV）- 6項目

| ID | 機能名 | 分類 | 理由 |
|----|-------|------|------|
| NAV-001 | ヘッダー | ⚪ 固有 | レイアウト・内容がプロジェクトで異なる |
| NAV-002 | サイドバー | ⚪ 固有 | 同上 |
| NAV-003 | フッター | ⚪ 固有 | 同上 |
| NAV-004 | パンくずリスト | ⚪ 固有 | 階層構造がプロジェクトで異なる |
| NAV-005 | タブナビゲーション | ⚪ 固有 | 同上 |
| NAV-006 | モバイルメニュー | ⚪ 固有 | 同上 |

**共通機能率**: 0/6（0%）- UIコンポーネントライブラリで対応

---

### 5. 検索・一覧（LIST）- 5項目

| ID | 機能名 | 分類 | 理由 |
|----|-------|------|------|
| LIST-001 | ページネーション | 🔶 共通候補 | パターン確立（カーソル/オフセット） |
| LIST-002 | ソート | 🔶 共通候補 | パターン確立 |
| LIST-003 | フィルタ | ⚪ 固有 | フィルタ項目がプロジェクトで異なる |
| LIST-004 | 検索（テキスト） | ⚪ 固有 | 検索対象がプロジェクトで異なる |
| LIST-005 | 無限スクロール | 🔶 共通候補 | パターン確立 |

**共通機能率**: 3/5（60%）

---

### 6. CRUD共通（CRUD）- 7項目

| ID | 機能名 | 分類 | 理由 |
|----|-------|------|------|
| CRUD-001 | 作成（Create） | ⚪ 固有 | エンティティがプロジェクトで異なる |
| CRUD-002 | 読み取り（Read） | ⚪ 固有 | 同上 |
| CRUD-003 | 更新（Update） | ⚪ 固有 | 同上 |
| CRUD-004 | 削除（Delete） | ⚪ 固有 | 同上 |
| CRUD-005 | 下書き保存 | ⚪ 固有 | 同上 |
| CRUD-006 | 一括操作 | ⚪ 固有 | 同上 |
| CRUD-007 | 楽観的ロック | 🔶 共通候補 | パターン確立（ETags等） |

**共通機能率**: 1/7（14%）- CRUDはエンティティ依存

---

### 7. 通知（NOTIF）- 5項目

| ID | 機能名 | 分類 | 理由 |
|----|-------|------|------|
| NOTIF-001 | メール通知 | 🔶 共通候補 | 基盤は共通（テンプレートは固有） |
| NOTIF-002 | アプリ内通知（トースト） | 🔶 共通候補 | UIパターン確立 |
| NOTIF-003 | 通知センター | ⚪ 固有 | 通知種別がプロジェクトで異なる |
| NOTIF-004 | プッシュ通知 | ⚪ 固有 | 通知内容がプロジェクトで異なる |
| NOTIF-005 | 通知設定 | ⚪ 固有 | 通知種別がプロジェクトで異なる |

**共通機能率**: 2/5（40%）

---

### 8. 監査・ログ（AUDIT）- 4項目

| ID | 機能名 | 分類 | 理由 |
|----|-------|------|------|
| AUDIT-001 | 操作ログ記録 | 🔶 共通候補 | パターン確立（記録対象は固有） |
| AUDIT-002 | ログイン履歴 | 🔶 共通候補 | パターン確立 |
| AUDIT-003 | 変更履歴表示 | ⚪ 固有 | 対象エンティティがプロジェクトで異なる |
| AUDIT-004 | エクスポート | ⚪ 固有 | 形式・内容がプロジェクトで異なる |

**共通機能率**: 2/4（50%）

---

### 9. エラー・例外（ERR）- 6項目

| ID | 機能名 | 分類 | 理由 |
|----|-------|------|------|
| ERR-001 | 404ページ | ✅ 共通 | 全アプリ共通 |
| ERR-002 | 403ページ | ✅ 共通 | 全アプリ共通 |
| ERR-003 | 500ページ | ✅ 共通 | 全アプリ共通 |
| ERR-004 | メンテナンスページ | ✅ 共通 | 全アプリ共通 |
| ERR-005 | ネットワークエラー表示 | 🔶 共通候補 | パターン確立 |
| ERR-006 | リトライ機構 | 🔶 共通候補 | パターン確立 |

**共通機能率**: 6/6（100%）

---

### 10. セキュリティ（SEC）- 7項目

| ID | 機能名 | 分類 | 理由 |
|----|-------|------|------|
| SEC-001 | CSRF対策 | ➖ 対象外 | フレームワーク/ミドルウェアで対応 |
| SEC-002 | CORS設定 | ➖ 対象外 | 設定ファイルで対応 |
| SEC-003 | レート制限 | ➖ 対象外 | ミドルウェア/インフラで対応 |
| SEC-004 | XSS対策 | ➖ 対象外 | フレームワークで対応 |
| SEC-005 | SQLインジェクション対策 | ➖ 対象外 | ORMで対応 |
| SEC-006 | ヘッダーセキュリティ | ➖ 対象外 | 設定で対応 |
| SEC-007 | 入力バリデーション | ➖ 対象外 | 各機能内で対応 |

**共通機能率**: 0/7（0%）- コア定義（SSOT-5）で方針のみ定義

---

### 11. 運用・管理（OPS）- 6項目

| ID | 機能名 | 分類 | 理由 |
|----|-------|------|------|
| OPS-001 | 管理画面 | ⚪ 固有 | 管理対象がプロジェクトで異なる |
| OPS-002 | ユーザー管理 | ⚪ 固有 | 管理項目がプロジェクトで異なる |
| OPS-003 | システム設定 | ⚪ 固有 | 設定項目がプロジェクトで異なる |
| OPS-004 | バックアップ | ➖ 対象外 | インフラで対応 |
| OPS-005 | メトリクス表示 | ➖ 対象外 | 監視ツールで対応 |
| OPS-006 | ヘルスチェック | ➖ 対象外 | インフラで対応 |

**共通機能率**: 0/6（0%）

---

### 12. AI特有（AI）- 8項目

| ID | 機能名 | 分類 | 理由 |
|----|-------|------|------|
| AI-001 | プロンプト管理 | ⚪ 固有 | AIアプリ固有、要件が多様 |
| AI-002 | ストリーミング応答 | 🔶 共通候補 | SSEパターン確立 |
| AI-003 | コンテキスト管理 | ⚪ 固有 | アプリごとに異なる |
| AI-004 | トークン使用量追跡 | ⚪ 固有 | 課金モデルで異なる |
| AI-005 | モデル切り替え | ⚪ 固有 | 使用モデルで異なる |
| AI-006 | PII検出・除去 | ⚪ 固有 | 対象データで異なる |
| AI-007 | レスポンスキャッシュ | ⚪ 固有 | キャッシュ戦略で異なる |
| AI-008 | フィードバック収集 | ⚪ 固有 | 収集項目で異なる |

**共通機能率**: 1/8（13%）

---

## 分類サマリー

### カテゴリ別

| カテゴリ | 全項目 | ✅共通 | 🔶候補 | ⚪固有 | ➖対象外 |
|---------|-------|-------|-------|-------|---------|
| 認証・認可 | 12 | 6 | 4 | 2 | 0 |
| アカウント | 6 | 1 | 5 | 0 | 0 |
| 権限・ロール | 5 | 1 | 1 | 3 | 0 |
| ナビゲーション | 6 | 0 | 0 | 6 | 0 |
| 検索・一覧 | 5 | 0 | 3 | 2 | 0 |
| CRUD共通 | 7 | 0 | 1 | 6 | 0 |
| 通知 | 5 | 0 | 2 | 3 | 0 |
| 監査・ログ | 4 | 0 | 2 | 2 | 0 |
| エラー・例外 | 6 | 4 | 2 | 0 | 0 |
| セキュリティ | 7 | 0 | 0 | 0 | 7 |
| 運用・管理 | 6 | 0 | 0 | 3 | 3 |
| AI特有 | 8 | 0 | 1 | 7 | 0 |
| **合計** | **77** | **12** | **21** | **34** | **10** |

### 結論

| 分類 | 項目数 | 割合 | 対応 |
|------|-------|------|------|
| ✅ 共通機能（確定） | 12 | 16% | 完成済み仕様書を提供 |
| 🔶 共通機能（候補） | 21 | 27% | 優先度に応じて仕様書作成 |
| ⚪ 固有機能 | 34 | 44% | テンプレートで新規作成 |
| ➖ 対象外 | 10 | 13% | インフラ/設定で対応 |

---

## 共通機能の仕様書提供状況

### 提供済み（✅ 確定）

| ID | 機能名 | ファイル | 状態 |
|----|-------|---------|------|
| AUTH-001 | ログイン | `auth/AUTH-001_login.md` | ✅ 完成 |
| AUTH-005 | ログアウト | `auth/AUTH-005_logout.md` | ✅ 完成 |
| AUTH-010 | トークンリフレッシュ | - | 📝 作成予定 |
| AUTH-002 | OAuth（Google） | - | 📝 作成予定 |
| AUTH-006 | パスワードリセット | - | 📝 作成予定 |
| ACCT-001 | サインアップ | `account/ACCT-001_signup.md` | ✅ 完成 |
| ERR-001 | 404ページ | - | 📝 作成予定 |
| ERR-002 | 403ページ | - | 📝 作成予定 |
| ERR-003 | 500ページ | - | 📝 作成予定 |
| ERR-004 | メンテナンスページ | - | 📝 作成予定 |
| ROLE-004 | 権限エラー表示 | - | ERR-002に統合 |
| AUTH-012 | 自動ログイン | - | AUTH-001に統合 |

---

## 共通機能の拡張

### 新しい共通機能を追加する場合

```
1. 判定フローで「共通機能」に該当するか確認
2. common-features/ に仕様書を作成
3. この文書（04_COMMON_FEATURE_DEFINITION.md）を更新
4. _INDEX.md を更新
```

### 候補（🔶）を確定（✅）に昇格する場合

```
1. 仕様書を作成
2. 2つ以上のプロジェクトで実際に使用して検証
3. カスタマイズポイントを特定・明示
4. この文書を更新
```

---

## 変更履歴

| 日付 | 変更内容 | 変更者 |
|------|---------|-------|
| | 初版作成 | |
