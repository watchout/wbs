# 22_FEATURE_ACCEPTANCE.md - 機能完了の最終検証

> 全タスクDone ≠ 機能完成。機能全体のE2E検証を行い、合格して初めて完成。

---

## なぜ必要か

```
個別タスクの監査で保証できること:
  ✅ DBが正しく定義されている
  ✅ APIが正しくレスポンスを返す
  ✅ UIが正しく表示される
  ✅ テストが全てパスする

個別タスクの監査で保証できないこと:
  ❌ DB → API → UI の一連の流れが正しく動くか
  ❌ 機能間のデータ受け渡しが正しいか
  ❌ ユーザーが実際に目的を達成できるか
  ❌ 非機能要件（速度、同時アクセス）が満たされるか

→ 機能の全タスクがDoneになった後、
   機能全体としての最終検証が必要
```

---

## 検証タイミング

```
  Sub-task: FEAT-XXX-DB    → Done ✅
  Sub-task: FEAT-XXX-API   → Done ✅
  Sub-task: FEAT-XXX-UI    → Done ✅
  Sub-task: FEAT-XXX-INT   → Done ✅
  Sub-task: FEAT-XXX-TEST  → Done ✅
      │
      ▼
  ★ 機能完了検証（このドキュメント）
      │
      ├── 合格 → 親Issue FEAT-XXX → Done ✅ → 機能完成
      └── 不合格 → 問題箇所特定 → 修正タスク作成 → 再検証
```

---

## 検証項目（5カテゴリ）

### 1. SSOT全MUST要件の実装確認

```
SSOTの §3 機能要件を1つずつ確認する。

方法:
  §3の全MUST要件をリスト化し、
  各要件に対して「実際に動作するか」を確認。
  コードの存在確認ではなく、実動作の確認。

  FR-001 [MUST]: ○○ → 実際に操作して確認 → ✅ / ❌
  FR-002 [MUST]: ○○ → 実際に操作して確認 → ✅ / ❌

  1つでも ❌ があれば不合格。
```

### 2. ユーザーフローE2E検証

```
SSOTの §2.4 ユーザーフローを最初から最後まで操作する。

方法:
  Playwright MCP でブラウザを操作し、
  ユーザーが実際に行う操作を再現する。

  Step 1: [画面]にアクセス → スクショ → 期待通りか
  Step 2: [操作] → スクショ → 期待通りか
  Step 3: [操作] → スクショ → 期待通りか
  ...
  最終Step: 目的達成 → スクショ → 期待通りか

  全ステップが期待通りであれば合格。
```

### 3. 異常系フロー検証

```
正常なフローだけでなく、異常なフローも確認する。

  - 未入力で送信 → 適切なエラー表示か
  - 不正な値で送信 → 適切なエラー表示か
  - 認証なしでアクセス → リダイレクトされるか
  - 通信エラー → フォールバック動作するか
  - 連打 → 二重送信されないか
```

### 4. 非機能要件の検証

```
SSOTの §8 非機能要件を確認する。

  パフォーマンス:
  - API応答時間が §8 の定義以内か
  - 画面表示が §8 の定義以内か

  セキュリティ:
  - 認証チェックが全エンドポイントで有効か
  - 他ユーザーのデータにアクセスできないか

  可用性:
  - エラー時にアプリが停止しないか
  - リトライが正しく動作するか
```

### 5. 他機能との結合確認

```
SSOTの §11 依存関係に基づき、
この機能が依存する/される機能との結合を確認する。

  依存する機能:
  - [機能A] のデータをこの機能で正しく取得できるか
  - [機能A] が停止した場合の振る舞いは正しいか

  依存される機能:
  - この機能のデータを [機能B] で正しく取得できるか
  - この機能を変更した場合 [機能B] が壊れていないか
```

---

## 検証スコアカード（100点満点）

```
┌─ 機能完了検証スコアカード ───────────────────────────────────────────┐
│                                                                       │
│  #   カテゴリ               配点   評価基準                           │
│  ─────────────────────────────────────────────────────────────────── │
│  1   MUST要件の実動作確認    30    全MUST要件が実際に動作するか       │
│  2   ユーザーフローE2E       25    正常フローが最初から最後まで通るか │
│  3   異常系フロー            20    異常入力・エラー時の動作が正しいか │
│  4   非機能要件              15    速度・セキュリティ・可用性         │
│  5   他機能との結合          10    依存機能との連携が正しいか         │
│                                                                       │
│  合計                       100                                       │
│  合格ライン                 100点                                     │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘

減点ルール:
  MUST要件の動作不良: -10点/件（致命的）
  正常フローの中断: -10点/件（致命的）
  異常系の未処理: -5点/件
  非機能要件の未達: -5点/件
  結合エラー: -5点/件
```

---

## 検証レポートテンプレート

```markdown
# 機能完了検証レポート

## 対象
| 項目 | 内容 |
|------|------|
| 機能ID | [FEAT-XXX] |
| 機能名 | [名前] |
| 検証日 | [YYYY-MM-DD] |
| 検証環境 | [Staging / localhost] |

## 1. MUST要件の実動作確認

| 要件ID | レベル | 要件内容 | 動作確認 | 結果 |
|--------|--------|---------|---------|------|
| FR-001 | MUST | [要件] | [確認方法] | ✅/❌ |

## 2. ユーザーフローE2E

| ステップ | 操作 | 期待結果 | 実際 | スクショ | 結果 |
|---------|------|---------|------|---------|------|
| 1 | [操作] | [期待] | [実際] | [画像] | ✅/❌ |

## 3. 異常系フロー

| ケース | 操作 | 期待動作 | 実際 | 結果 |
|--------|------|---------|------|------|
| 未入力送信 | [操作] | [エラー表示] | [実際] | ✅/❌ |

## 4. 非機能要件

| 項目 | 基準値 | 実測値 | 結果 |
|------|--------|--------|------|
| API応答 | 3秒以内 | X秒 | ✅/❌ |

## 5. 他機能との結合

| 関連機能 | 関係 | 確認内容 | 結果 |
|---------|------|---------|------|
| [機能A] | 依存 | [確認内容] | ✅/❌ |

## スコア

| # | カテゴリ | 配点 | 得点 | 減点理由 |
|---|---------|------|------|---------|
| 1 | MUST実動作 | 30 | /30 | |
| 2 | E2Eフロー | 25 | /25 | |
| 3 | 異常系 | 20 | /20 | |
| 4 | 非機能 | 15 | /15 | |
| 5 | 結合 | 10 | /10 | |
| **合計** | | **100** | **/100** | |

## 判定
✅ 合格（100点）/ ❌ 不合格（修正後再検証）
```

---

## 変更履歴

| 日付 | 変更内容 | 変更者 |
|------|---------|-------|
| | 初版作成 | |
