# 05_PROJECT_DOCUMENTS.md - プロジェクトドキュメント定義

> 開発プロジェクトに必要な全ドキュメントと、各ドキュメントで決定すべき事項を定義

---

## 目的

1. **漏れ防止**: 必要なドキュメントを一覧化し、抜け漏れを防ぐ
2. **品質担保**: 各ドキュメントで「何を決めるか」を明確化
3. **開始基準**: 「どこまで決めたら開発に入れるか」を定義

---

## ドキュメント全体像

```
プロジェクトドキュメント
│
├── A. プロジェクト基盤（Project Foundation）
│   ├── A1. プロダクト要件定義書（PRD）
│   ├── A2. 技術スタック定義書
│   ├── A3. 開発環境定義書
│   └── A4. チーム・役割定義書
│
├── B. 設計ドキュメント（Design Documents）
│   ├── B1. 機能カタログ
│   ├── B2. 機能仕様書（各機能）
│   ├── B3. 画面・状態定義書
│   ├── B4. API定義書
│   ├── B5. データモデル定義書
│   └── B6. 横断的関心事定義書
│
├── C. 開発規約（Development Standards）
│   ├── C1. コーディング規約
│   ├── C2. Git運用規約
│   ├── C3. テスト規約
│   └── C4. レビュー規約
│
├── D. 運用ドキュメント（Operations）
│   ├── D1. 環境構成定義書
│   ├── D2. デプロイ手順書
│   ├── D3. 監視・アラート定義書
│   └── D4. 障害対応手順書
│
└── E. 管理ドキュメント（Management）
    ├── E1. プロジェクト計画書
    ├── E2. リスク管理表
    └── E3. 変更管理記録
```

---

## 開発フェーズとドキュメントの関係

| ドキュメント | Phase 0<br>要件定義 | Phase 1<br>機能設計 | Phase 2<br>技術設計 | Phase 3<br>実装 | 備考 |
|-------------|:------------------:|:------------------:|:------------------:|:--------------:|------|
| A1. PRD | **必須** | 参照 | 参照 | 参照 | 最初に作成 |
| A2. 技術スタック | **必須** | 参照 | 参照 | 参照 | 最初に作成 |
| A3. 開発環境 | 作成開始 | **必須** | 参照 | 参照 | Phase 1開始前に完成 |
| A4. チーム・役割 | **必須** | 参照 | 参照 | 参照 | 最初に作成 |
| B1. 機能カタログ | **必須** | 更新 | 参照 | 参照 | |
| B2. 機能仕様書 | - | **必須** | 参照 | 参照 | 各機能ごと |
| B3. 画面・状態 | - | **必須** | 更新 | 参照 | |
| B4. API定義 | - | 作成開始 | **必須** | 参照 | |
| B5. データモデル | - | 作成開始 | **必須** | 参照 | |
| B6. 横断的関心事 | - | 作成開始 | **必須** | 参照 | |
| C1. コーディング規約 | - | - | **必須** | 参照 | |
| C2. Git運用規約 | - | - | **必須** | 参照 | |
| C3. テスト規約 | - | - | **必須** | 参照 | |
| C4. レビュー規約 | - | - | **必須** | 参照 | |
| D1-D4. 運用系 | - | - | 作成開始 | 更新 | リリース前に完成 |
| E1-E3. 管理系 | 作成開始 | 更新 | 更新 | 更新 | 継続的に更新 |

**凡例**:
- **必須**: このフェーズで完成必須
- 作成開始: このフェーズで作成開始
- 更新: 必要に応じて更新
- 参照: 参照のみ（変更不可または変更には承認必要）

---

## A. プロジェクト基盤

### A1. プロダクト要件定義書（PRD）

**対応ファイル**: `ssot/SSOT-0_PRD.md`

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| プロダクト概要（1文） | **必須** | 誰でも同じ説明ができる |
| 対象ユーザー | **必須** | ペルソナまたはセグメントが明確 |
| 解決する課題 | **必須** | 課題が具体的かつ検証可能 |
| ユースケース一覧 | **必須** | 主要ユースケースが網羅されている |
| Goals（やること） | **必須** | 優先順位付きで列挙 |
| Non-Goals（やらないこと） | **必須** | 明示的に除外 |
| 成功指標（KPI） | **必須** | 測定可能な指標 |
| 制約条件 | **必須** | 技術・予算・期間・法規制 |
| 前提条件 | 任意 | 依存する外部要因 |
| リスク | 任意 | 主要リスクと対策 |

**完成基準**: 上記「必須」が全て埋まり、ステークホルダー承認済み

---

### A2. 技術スタック定義書

**対応ファイル**: `ssot/TECH_STACK.md`（新規）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| 言語 | **必須** | バージョンまで確定 |
| フロントエンドフレームワーク | **必須** | バージョンまで確定 |
| バックエンドフレームワーク | **必須** | バージョンまで確定 |
| データベース | **必須** | 種類・バージョン確定 |
| ORM/データアクセス | **必須** | ライブラリ確定 |
| 認証方式 | **必須** | JWT/Session/OAuth等 |
| ホスティング/インフラ | **必須** | 環境確定 |
| CI/CD | **必須** | ツール確定 |
| 主要ライブラリ | 任意 | 重要なもののみ |
| 選定理由 | 任意 | 重要な判断はADRに記録 |

**完成基準**: 実装に必要な全技術が確定し、互換性が検証済み

---

### A3. 開発環境定義書

**対応ファイル**: `ssot/DEV_ENVIRONMENT.md`（新規）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| ローカル環境構築手順 | **必須** | 新メンバーが1時間以内に構築可能 |
| 必要なツール一覧 | **必須** | バージョン含む |
| 環境変数一覧 | **必須** | 必須/任意、説明付き |
| ローカルDB構築方法 | **必須** | Docker or ローカルインストール |
| 開発サーバー起動方法 | **必須** | コマンド明記 |
| テスト実行方法 | **必須** | コマンド明記 |
| IDE推奨設定 | 任意 | 設定ファイル共有 |
| トラブルシューティング | 任意 | よくある問題と解決策 |

**完成基準**: 新メンバーがドキュメントのみで環境構築できる

---

### A4. チーム・役割定義書

**対応ファイル**: `02_ROLES_AND_RESPONSIBILITIES.md`（既存）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| ロール一覧 | **必須** | 全ロールが定義されている |
| 各ロールの責任 | **必須** | 曖昧さがない |
| RACIマトリクス | **必須** | 主要アクティビティをカバー |
| 承認フロー | **必須** | 誰が何を承認するか明確 |
| コミュニケーション方法 | 任意 | ツール・チャンネル |
| 会議体定義 | 任意 | 定例会議の目的・頻度 |

**完成基準**: 各作業の担当者・承認者が明確

---

## B. 設計ドキュメント

### B1. 機能カタログ

**対応ファイル**: `ssot/SSOT-1_FEATURE_CATALOG.md`（既存）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| 機能一覧（77項目チェック） | **必須** | 全項目を確認済み |
| 各機能の採否 | **必須** | In/Out/Futureが明確 |
| 優先度（P0/P1/P2/P3） | **必須** | P0が特定されている |
| 依存関係 | **必須** | 機能間の依存が明確 |
| 共通/固有の分類 | **必須** | どの仕様書を使うか明確 |

**完成基準**: 実装対象機能が確定し、優先順位が決まっている

---

### B2. 機能仕様書

**対応ファイル**: `features/{ID}_xxx.md` または `common-features/`（既存）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| 機能概要 | **必須** | 目的が1-2文で説明できる |
| ユーザーストーリー | **必須** | As-I-Want-So形式 |
| スコープ（In/Out） | **必須** | 境界が明確 |
| 受入条件（正常系） | **必須** | 3〜7個、検証可能 |
| 受入条件（異常系） | **必須** | エラーケースが網羅 |
| 受入条件（エッジケース） | **必須** | 境界値・例外が網羅 |
| UI仕様 | **必須** | レイアウト・要素・状態 |
| 状態遷移 | **必須** | 状態図・遷移ルール |
| API仕様 | **必須** | リクエスト・レスポンス・エラー |
| データモデル | **必須** | テーブル・カラム・操作 |
| ビジネスロジック | **必須** | 処理フロー |
| エラーハンドリング | **必須** | 表示・ログ |
| テスト仕様 | **必須** | テストケース |
| 非機能要件 | 任意 | パフォーマンス目標 |
| 依存関係 | **必須** | 前提・後続機能 |

**完成基準（L3レベル）**: 上記「必須」が全て埋まり、AIが実装可能な状態

---

### B3. 画面・状態定義書

**対応ファイル**: `core/SSOT-2_UI_STATE.md`（既存）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| 画面一覧 | **必須** | 全画面がリスト化 |
| 画面分類（Public/Protected/Admin） | **必須** | 認証要件が明確 |
| URLパス設計 | **必須** | パス命名規則が一貫 |
| 認証状態定義 | **必須** | S0-S4が定義済み |
| 状態遷移図 | **必須** | 認証フローが図示 |
| ルートガードルール | **必須** | Rule 1-5が定義済み |
| 共通レイアウト | 任意 | ヘッダー・フッター等 |

**完成基準**: 全画面と認証フローが定義され、ルートガードが実装可能

---

### B4. API定義書

**対応ファイル**: `core/SSOT-3_API_CONTRACT.md`（既存）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| ベースURL | **必須** | 環境ごとに定義 |
| 認証方式 | **必須** | Bearer/Cookie等 |
| 共通ヘッダー | **必須** | Content-Type等 |
| レスポンス形式 | **必須** | 成功・エラーの構造 |
| エラーコード体系 | **必須** | プレフィックス・意味 |
| HTTPステータス使い分け | **必須** | 各ステータスの用途 |
| ページネーション方式 | **必須** | カーソル/オフセット |
| バージョニング方針 | 任意 | URL/ヘッダー |
| レート制限 | 任意 | エンドポイント別 |

**完成基準**: 全エンドポイントが一貫したルールで設計可能

---

### B5. データモデル定義書

**対応ファイル**: `core/SSOT-4_DATA_MODEL.md`（既存）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| 命名規則 | **必須** | テーブル・カラム名 |
| 主キー形式 | **必須** | UUID/連番/プレフィックス |
| 共通カラム | **必須** | id, created_at等 |
| 外部キー方針 | **必須** | 制約の有無・命名 |
| インデックス方針 | **必須** | 作成基準 |
| 論理削除方針 | **必須** | deleted_atの扱い |
| タイムスタンプ | **必須** | タイムゾーン（UTC） |
| エンティティ一覧 | **必須** | 主要テーブル定義 |
| ER図 | 任意 | 関係の可視化 |

**完成基準**: 全テーブルが一貫したルールで設計可能

---

### B6. 横断的関心事定義書

**対応ファイル**: `core/SSOT-5_CROSS_CUTTING.md`（既存）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| 認証方式詳細 | **必須** | トークン構造・有効期限 |
| セッション管理 | **必須** | 同時接続・タイムアウト |
| エラーハンドリング方針 | **必須** | 表示・ログ・通知 |
| ログ出力方針 | **必須** | レベル・形式・機密情報 |
| セキュリティ要件 | **必須** | 暗号化・ヘッダー・CORS |
| 国際化（i18n） | 任意 | 対応言語・キー命名 |
| パフォーマンス目標 | 任意 | 応答時間・LCP |

**完成基準**: 全機能が参照する共通ルールが確定

---

## C. 開発規約

### C1. コーディング規約

**対応ファイル**: `standards/CODING_STANDARDS.md`（新規）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| ファイル命名規則 | **必須** | kebab-case等 |
| 変数・関数命名規則 | **必須** | camelCase等 |
| コンポーネント命名規則 | **必須** | PascalCase等 |
| ディレクトリ構造 | **必須** | 階層・分類ルール |
| インポート順序 | **必須** | 外部→内部→型 |
| コメント規約 | 任意 | JSDoc等 |
| フォーマッター設定 | **必須** | Prettier設定 |
| リンター設定 | **必須** | ESLint設定 |

**完成基準**: AIが生成するコードが一貫したスタイルになる

---

### C2. Git運用規約

**対応ファイル**: `standards/GIT_WORKFLOW.md`（新規）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| ブランチ戦略 | **必須** | GitHub Flow/Git Flow等 |
| ブランチ命名規則 | **必須** | feature/xxx等 |
| コミットメッセージ規約 | **必須** | Conventional Commits等 |
| PRテンプレート | **必須** | 必須記載事項 |
| マージルール | **必須** | Squash/Rebase等 |
| レビュー必須人数 | **必須** | 1人以上等 |
| 保護ブランチ設定 | 任意 | main/develop等 |

**完成基準**: チーム全員が同じGit運用ができる

---

### C3. テスト規約

**対応ファイル**: `standards/TESTING_STANDARDS.md`（新規）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| テスト種別 | **必須** | Unit/Integration/E2E |
| テストフレームワーク | **必須** | Jest/Vitest等 |
| カバレッジ目標 | **必須** | 80%等 |
| テストファイル配置 | **必須** | __tests__/同階層等 |
| テスト命名規則 | **必須** | describe/it形式等 |
| モック方針 | 任意 | 何をモックするか |
| テストデータ管理 | 任意 | Factory/Fixture等 |

**完成基準**: テストが一貫した方法で書ける

---

### C4. レビュー規約

**対応ファイル**: `checklists/REVIEW_CHECKLIST.md`（既存）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| レビュー観点 | **必須** | 設計・コード・セキュリティ |
| 指摘レベル定義 | **必須** | must/should/nit |
| レビュー期限 | 任意 | 24時間以内等 |
| 自己レビューチェックリスト | 任意 | PR前に確認 |

**完成基準**: レビューの品質が均一になる

---

## D. 運用ドキュメント

### D1. 環境構成定義書

**対応ファイル**: `operations/ENVIRONMENTS.md`（新規）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| 環境一覧 | **必須** | dev/stg/prod等 |
| 各環境の用途 | **必須** | 誰が何に使うか |
| 環境別URL | **必須** | 各環境のエンドポイント |
| 環境別設定差分 | **必須** | DB接続先等 |
| アクセス権限 | **必須** | 誰がどの環境にアクセス可能か |

**完成基準**: 各環境の役割と設定が明確

---

### D2. デプロイ手順書

**対応ファイル**: `operations/DEPLOYMENT.md`（新規）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| デプロイフロー | **必須** | 手順が明確 |
| デプロイトリガー | **必須** | 手動/自動（マージ時等） |
| ロールバック手順 | **必須** | 問題発生時の対応 |
| デプロイ前チェックリスト | 任意 | 確認事項 |
| 通知先 | 任意 | デプロイ完了通知 |

**完成基準**: 誰でも安全にデプロイできる

---

### D3. 監視・アラート定義書

**対応ファイル**: `operations/MONITORING.md`（新規）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| 監視ツール | **必須** | Datadog/CloudWatch等 |
| 監視メトリクス | **必須** | 何を監視するか |
| アラート条件 | **必須** | 閾値・重要度 |
| 通知先 | **必須** | Slack/PagerDuty等 |
| ダッシュボード | 任意 | 可視化内容 |

**完成基準**: 異常を検知・通知できる

---

### D4. 障害対応手順書

**対応ファイル**: `operations/INCIDENT_RESPONSE.md`（新規）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| 障害レベル定義 | **必須** | Critical/Major/Minor |
| エスカレーションフロー | **必須** | 誰にいつ連絡するか |
| 初動対応手順 | **必須** | 最初にやること |
| ポストモーテムテンプレート | 任意 | 振り返り形式 |

**完成基準**: 障害発生時に迷わず対応できる

---

## E. 管理ドキュメント

### E1. プロジェクト計画書

**対応ファイル**: `management/PROJECT_PLAN.md`（新規）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| マイルストーン | **必須** | 主要な節目 |
| スケジュール | **必須** | 大まかな期間 |
| スコープ | **必須** | PRDと整合 |
| リソース | 任意 | チーム人数 |

---

### E2. リスク管理表

**対応ファイル**: `management/RISKS.md`（新規）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| リスク一覧 | 任意 | 識別されたリスク |
| 影響度・発生確率 | 任意 | 優先順位付け |
| 対策 | 任意 | 予防・軽減策 |

---

### E3. 変更管理記録

**対応ファイル**: `management/CHANGES.md`（新規）

| 決定事項 | 必須/任意 | 決定基準 |
|---------|----------|---------|
| 変更要求記録 | 任意 | 何がいつ変わったか |
| 影響分析 | 任意 | 変更の影響範囲 |
| 承認記録 | 任意 | 誰が承認したか |

---

## 開発開始基準（Definition of Ready for Development）

### Phase 0完了 → Phase 1開始の条件

| ドキュメント | 完成度 |
|-------------|--------|
| A1. PRD | 100%（必須項目全て） |
| A2. 技術スタック | 100% |
| A4. チーム・役割 | 100% |
| B1. 機能カタログ | 100%（P0機能確定） |

### Phase 1完了 → Phase 2開始の条件

| ドキュメント | 完成度 |
|-------------|--------|
| A3. 開発環境 | 100% |
| B2. 機能仕様書（P0） | 100%（L3レベル） |
| B3. 画面・状態定義 | 100% |

### Phase 2完了 → Phase 3開始の条件

| ドキュメント | 完成度 |
|-------------|--------|
| B4. API定義書 | 100% |
| B5. データモデル定義書 | 100% |
| B6. 横断的関心事定義書 | 100% |
| C1. コーディング規約 | 100% |
| C2. Git運用規約 | 100% |
| C3. テスト規約 | 100% |

---

## ドキュメントテンプレート一覧

| ID | ドキュメント | テンプレートファイル | 状態 |
|----|-------------|-------------------|------|
| A1 | PRD | `ssot/SSOT-0_PRD.md` | ✅ 提供済み |
| A2 | 技術スタック | `templates/TECH_STACK.md` | 📝 新規作成 |
| A3 | 開発環境 | `templates/DEV_ENVIRONMENT.md` | 📝 新規作成 |
| A4 | チーム・役割 | `02_ROLES_AND_RESPONSIBILITIES.md` | ✅ 提供済み |
| B1 | 機能カタログ | `ssot/SSOT-1_FEATURE_CATALOG.md` | ✅ 提供済み |
| B2 | 機能仕様書 | `project-features/_TEMPLATE.md` | ✅ 提供済み |
| B3 | 画面・状態 | `core/SSOT-2_UI_STATE.md` | ✅ 提供済み |
| B4 | API定義 | `core/SSOT-3_API_CONTRACT.md` | ✅ 提供済み |
| B5 | データモデル | `core/SSOT-4_DATA_MODEL.md` | ✅ 提供済み |
| B6 | 横断的関心事 | `core/SSOT-5_CROSS_CUTTING.md` | ✅ 提供済み |
| C1 | コーディング規約 | `templates/CODING_STANDARDS.md` | 📝 新規作成 |
| C2 | Git運用規約 | `templates/GIT_WORKFLOW.md` | 📝 新規作成 |
| C3 | テスト規約 | `templates/TESTING_STANDARDS.md` | 📝 新規作成 |
| C4 | レビュー規約 | `checklists/REVIEW_CHECKLIST.md` | ✅ 提供済み |
| D1 | 環境構成 | `templates/ENVIRONMENTS.md` | 📝 新規作成 |
| D2 | デプロイ手順 | `templates/DEPLOYMENT.md` | 📝 新規作成 |
| D3 | 監視・アラート | `templates/MONITORING.md` | 📝 新規作成 |
| D4 | 障害対応 | `templates/INCIDENT_RESPONSE.md` | 📝 新規作成 |
| E1 | プロジェクト計画 | `templates/PROJECT_PLAN.md` | 📝 新規作成 |
| E2 | リスク管理 | `templates/RISKS.md` | 📝 新規作成 |
| E3 | 変更管理 | `templates/CHANGES.md` | 📝 新規作成 |

---

## F. 意思決定ログ（notes/）

### 目的

```
AIの長期記憶として機能する。

課題:
  AIのコンテキストはセッションごとにリセットされる。
  PRやタスクでの意思決定の「理由」が失われる。

解決策:
  notes/ ディレクトリにPR・タスクごとの意思決定ログを蓄積。
  新しいセッションでも過去の判断を参照できる。
```

### ディレクトリ構造

```
docs/
└── notes/                         ← 意思決定ログ（AIの長期記憶）
    ├── README.md                  ← notes/ の使い方
    ├── YYYY-MM-DD_FEAT-XXX.md     ← 機能実装時のログ
    ├── YYYY-MM-DD_FIX-XXX.md      ← バグ修正時のログ
    ├── YYYY-MM-DD_REFACTOR-XXX.md ← リファクタ時のログ
    └── YYYY-MM-DD_DECISION-XXX.md ← 設計判断時のログ
```

### ログテンプレート

```markdown
# [日付] [タスクID] [タイトル]

## コンテキスト
[何をしていたか、何が問題だったか]

## 検討した選択肢
1. [選択肢A] - [メリット] / [デメリット]
2. [選択肢B] - [メリット] / [デメリット]
3. [選択肢C] - [メリット] / [デメリット]

## 決定
[選択肢X] を採用。

## 理由
[なぜこの選択肢にしたか]

## 影響
[この決定が影響する他の機能・コード]

## 関連
- PR: #XXX
- SSOT: [変更したSSOT]
- ADR: [関連するADR]
```

### 運用ルール

```
書くタイミング:
  - PR作成時（PRの意思決定をログに残す）
  - 中断質問の回答後（回答内容と理由をログに残す）
  - 設計変更時（変更の理由をログに残す）
  - バグ修正時（根本原因と修正方針をログに残す）

AIへの指示:
  「新しいセッションを開始したら、
   まず docs/notes/ を読んで
   過去の意思決定を把握してください。」

命名規則:
  YYYY-MM-DD_[TYPE]-[ID].md
  TYPE: FEAT / FIX / REFACTOR / DECISION
  ID: 機能IDまたは連番

保持期間:
  削除しない。プロジェクトの履歴として永続保持。
```

---

## 変更履歴

| 日付 | 変更内容 | 変更者 |
|------|---------|-------|
| | 初版作成 | |
| | F. 意思決定ログ（notes/）セクション追加 | |
