# 16_PROMPT_AUDIT.md - プロンプト品質監査

> 実装プロンプトを投げる前に品質を保証する

---

## なぜプロンプトを監査するのか

```
プロンプトの品質 = 実装の品質

  90点のプロンプト → 1回で正しい実装が得られる   → 30分で完了
  60点のプロンプト → 3回修正指示を出して完成     → 2時間かかる
  30点のプロンプト → 何度やってもゴミが出る       → 最初からやり直し

プロンプト監査に10分かけることで、
手戻りの2時間を防ぐ。

これはコードレビューと同じ思想:
  コードを書いてからレビュー → 問題を早期発見
  プロンプトを書いてから監査 → 品質を事前保証
```

---

## 監査プロセス

```
  プロンプト作成
      │
      ▼
  ① 自動チェック（全セクション存在確認）
      │
      ▼
  ② 品質スコアリング（100点満点）
      │
      ▼
  ③ 指摘事項 + 修正
      │
      ├── 100点 → 合格 ✅ → 実装へ
      ├── 90-99点 → 指摘箇所を修正 → 再監査
      └── 89点以下 → 大幅修正 → 再監査
      │
      ▼
  100点で合格 → AIに投入して実装開始
```

---

## 品質スコアカード（100点満点）

```
┌─ プロンプト品質スコアカード ──────────────────────────────────────────┐
│                                                                        │
│  #   カテゴリ             配点   評価基準                              │
│  ──────────────────────────────────────────────────────────────────── │
│  1   ロール適切性          10    レイヤーに合った専門性が定義されているか│
│  2   コンテキスト完全性    25    SSOT参照が原文で貼られ、情報の欠落がないか│
│  3   タスク明確性          20    何を実装するか・順序・ファイル構成が明確か│
│  4   制約網羅性            15    技術・規約・アーキテクチャ制約が漏れなく記載か│
│  5   アウトプット指定      10    出力形式・必須要素・不要な要素が明示されているか│
│  6   受け入れ基準          10    SSOTのMUST要件が全て転記されているか    │
│  7   禁止事項              5     AI共通の問題行動が事前に防止されているか│
│  8   全体整合性            5     セクション間で矛盾がないか             │
│                                                                        │
│  合計                    100                                            │
│  合格ライン              100点（満点必須）                              │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

---

## カテゴリ別 詳細採点基準

### 1. ロール適切性（10点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| 専門性の一致 | 4 | レイヤー（DB/API/UI/テスト）に合った専門家ロール |
| 技術スタックの明示 | 3 | 使用する具体的な技術名がロール内に記載 |
| 原則の具体性 | 3 | 「良いコードを書く」ではなく具体的な原則 |

**減点ルール:**
- ロール定義がない: -10点（全額）
- レイヤーと専門性が不一致（例: UI実装にDBAロール）: -4点
- 技術スタック名が欠落: -3点
- 原則が「良いコードを書く」レベルの曖昧さ: -2点/件

---

### 2. コンテキスト完全性（25点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| SSOT参照セクション | 8 | 該当セクションの原文が貼られている（要約ではない） |
| 技術スタック情報 | 5 | TECH_STACK.md の該当部分が含まれている |
| コーディング規約 | 4 | CODING_STANDARDS.md の該当部分が含まれている |
| 既存実装の参照 | 4 | 関連する既存コードが含まれている |
| 依存する先行成果物 | 4 | 先行タスクの出力が含まれている |

**減点ルール:**
- SSOTの参照が要約になっている: -8点（原文必須）
- SSOTの参照セクションが間違っている: -8点
- 技術スタック情報がない: -5点
- コーディング規約がない: -4点
- 先行タスクの成果物が未参照: -4点
- 「既存コードは適宜参照してください」等の曖昧な指示: -4点

**最重要カテゴリ: AIは与えられた情報だけで実装する。情報が欠けると推測で埋める。**

---

### 3. タスク明確性（20点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| 実装内容の列挙 | 6 | やることが箇条書きで全て列挙されている |
| 実装順序の指定 | 6 | 番号付きで順序が指定されている |
| ファイル構成 | 4 | 作成/変更するファイルのフルパスが列挙されている |
| スコープの明確性 | 4 | 「何をやらないか」も明示されている |

**減点ルール:**
- 実装内容が「APIを実装して」レベル: -6点
- 実装順序がない: -6点
- ファイルパスが不明: -4点
- スコープ外が未定義: -4点
- 「適宜実装してください」: -3点/件

---

### 4. 制約網羅性（15点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| 技術制約 | 5 | 使う/使わないライブラリが明示 |
| コーディング規約 | 4 | 命名、ファイル構成、エラー処理パターン |
| アーキテクチャ制約 | 4 | レイヤー構成、依存方向 |
| パフォーマンス制約 | 2 | 応答時間、メモリ等の数値目標 |

**減点ルール:**
- 技術制約セクションがない: -5点
- 「ベストプラクティスに従って」等の曖昧な制約: -3点
- アーキテクチャ制約がない（AIが自由に構造を決める危険性）: -4点
- 矛盾する制約: -3点/件

---

### 5. アウトプット指定（10点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| 出力形式の指定 | 4 | 「完全なファイル内容」「省略不可」が明示 |
| 必須要素 | 3 | 型定義、エラーハンドリング等のチェックリスト |
| 不要な要素 | 3 | 説明文不要、テスト別途等の除外指定 |

**減点ルール:**
- 「完全なファイル内容を出力」の指示がない: -4点
- 必須要素のチェックリストがない: -3点
- 不要な要素が未定義: -3点

---

### 6. 受け入れ基準（10点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| MUST要件の転記 | 6 | SSOTの §3 から全MUSTが転記されている |
| 確認項目 | 4 | 型安全性、規約準拠等のチェックリスト |

**減点ルール:**
- SSOTのMUST要件が1つでも欠落: -2点/件
- 確認項目がない: -4点
- 受け入れ基準セクション自体がない: -10点（全額）

---

### 7. 禁止事項（5点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| 共通禁止事項 | 3 | any型、console.log、ハードコード等 |
| タスク固有禁止事項 | 2 | このタスク特有のアンチパターン |

**減点ルール:**
- 禁止事項セクションがない: -5点（全額）
- 「途中省略不可」が含まれていない: -2点
- 「SSOT外の独自仕様追加不可」が含まれていない: -2点

---

### 8. 全体整合性（5点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| セクション間の矛盾 | 3 | 制約と実装内容が矛盾していないか |
| SSOT との整合 | 2 | 参照しているSSOTのバージョンが最新か |

**減点ルール:**
- セクション間の矛盾: -3点/件
- 古いバージョンのSSO参照: -2点

---

## 監査レポートテンプレート

```markdown
# プロンプト監査レポート

## 対象
| 項目 | 内容 |
|------|------|
| タスクID | [FEAT-XXX-LAYER] |
| プロンプトバージョン | v1 / v2 / ... |
| 監査日 | [YYYY-MM-DD] |

## スコア

| # | カテゴリ | 配点 | 得点 | 減点理由 |
|---|---------|------|------|---------|
| 1 | ロール適切性 | 10 | /10 | |
| 2 | コンテキスト完全性 | 25 | /25 | |
| 3 | タスク明確性 | 20 | /20 | |
| 4 | 制約網羅性 | 15 | /15 | |
| 5 | アウトプット指定 | 10 | /10 | |
| 6 | 受け入れ基準 | 10 | /10 | |
| 7 | 禁止事項 | 5 | /5 | |
| 8 | 全体整合性 | 5 | /5 | |
| **合計** | | **100** | **/100** | |

## 判定
| 判定 | 条件 |
|------|------|
| ✅ 合格 | 100点（満点） |
| ⚠️ 修正要 | 90-99点 → 指摘箇所を修正して再監査 |
| ❌ 大幅修正 | 89点以下 → 構造から見直し |

**今回の判定: [合格/修正要/大幅修正]**

## 指摘事項

| # | カテゴリ | 指摘内容 | 修正案 |
|---|---------|---------|-------|
| 1 | | | |
| 2 | | | |
```

---

## AIへの監査実行指示

```
以下の実装プロンプトを監査してください。

プロンプト:
[プロンプト全文をペースト]

監査基準: 16_PROMPT_AUDIT.md に従い、
8カテゴリ・100点満点でスコアリングしてください。

特に重点チェック:
- §2 コンテキスト: SSOTの原文が貼られているか（要約は不可）
- §3 タスク: 実装順序とファイル構成が明確か
- §6 受け入れ基準: SSOTのMUST要件が全て含まれているか

100点未満の場合、具体的な修正案を提示してください。
```

---

## 実装フロー（タスク1つの完全な流れ）

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  GitHub Projects: タスクを In Progress に変更
        │
        ▼
  ① プロンプト作成（15_PROMPT_FORMAT.md に従う）
     - §1〜§7 を全て記入
     - SSOTの該当セクション原文を貼り付け
        │
        ▼
  ② プロンプト監査（16_PROMPT_AUDIT.md に従う）
     - 8カテゴリ・100点満点
     - AIに監査させる or セルフチェック
        │
        ├── 100点 → ✅ 合格
        └── 99点以下 → 修正 → 再監査 → 100点まで繰り返す
        │
        ▼
  ③ プロンプトをAIに投入（実装）
     - Claude Code に投入
     - 出力されたコードを確認
        │
        ▼
  ④ 実装結果の確認
     - §6 受け入れ基準のチェックリストを確認
     - 全MUST要件が満たされているか
     - テスト実行（パスするか）
        │
        ├── 全て ✅ → 次へ
        └── 不足あり → 追加プロンプト作成 → ②から
        │
        ▼
  ⑤ Git操作
     - ブランチにコミット
     - PR作成（14_IMPLEMENTATION_ORDER.md のPRテンプレート）
     - CI通過確認
        │
        ▼
  ⑥ コードレビュー → マージ
        │
        ▼
  GitHub Projects: タスクを Done に変更

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ✅ 1タスク完了 → 次のタスクへ
```

---

## 変更履歴

| 日付 | 変更内容 | 変更者 |
|------|---------|-------|
| | 初版作成 | |
