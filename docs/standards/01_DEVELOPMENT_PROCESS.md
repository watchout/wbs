# 01_DEVELOPMENT_PROCESS.md - 開発プロセス定義

> 各フェーズの詳細、成果物、ゲート条件、AIの役割を定義

---

## 開発フロー全体像

```
┌──────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│   Phase 0        Phase 1        Phase 2        Phase 3        Phase 4    │
│   要件定義   →   機能設計   →   技術設計   →    実装    →   レビュー     │
│                                                                          │
│   [GATE 0]       [GATE 1]       [GATE 2]       [GATE 3]       [GATE 4]   │
│   PRD承認        仕様承認       技術承認       テスト通過     マージ承認   │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## Phase 0: 要件定義

### 目的
「何を作るか」「なぜ作るか」を明確にする

### 成果物

| 成果物 | ファイル | 担当 |
|--------|---------|------|
| プロダクト要件書 | `ssot/SSOT-0_PRD.md` | PO/PM |
| 機能カタログ（初版） | `ssot/SSOT-1_FEATURE_CATALOG.md` | PO/PM |

### 作業内容

```
1. SSOT-0を作成
   - プロダクト概要（エレベーターピッチ）
   - 対象ユーザー・ペルソナ
   - ユースケース一覧
   - Goals / Non-Goals
   - 成功指標（KPI）
   - 制約条件

2. SSOT-1で機能を棚卸し
   - 77項目の標準機能チェック
   - 必要な機能にチェック
   - 優先度（P0/P1/P2/P3）設定
   - スコープ外を明示
```

### Gate 0: 要件定義完了条件

| # | 条件 | 確認 |
|---|------|------|
| 1 | SSOT-0の全セクションが埋まっている | ☐ |
| 2 | Goals/Non-Goalsが明確に分離されている | ☐ |
| 3 | P0機能が特定されている（5〜15個程度） | ☐ |
| 4 | ステークホルダーの承認を得た | ☐ |

**Gate 0を通過しないと Phase 1 に進めない**

---

## Phase 1: 機能設計

### 目的
各機能の「完全な仕様」を定義する

### 成果物

| 成果物 | ファイル | 担当 |
|--------|---------|------|
| 機能別仕様書 | `features/{ID}_xxx.md` | 設計者 |
| 画面・状態定義（更新） | `ssot/SSOT-2_UI_STATE.md` | 設計者 |

### 作業内容

```
1. P0機能から順に features/*.md を作成
   - テンプレート（features/_TEMPLATE.md）を使用
   - 全セクションを埋める
   - 受入条件を明確に定義
   - エッジケースを列挙

2. SSOT-2を更新
   - 新しい画面があれば追加
   - 状態遷移を更新
```

### 機能仕様の完成度レベル

| レベル | 状態 | AIに渡せるか |
|-------|------|-------------|
| L0 | 機能名のみ | ❌ |
| L1 | 概要 + 受入条件 | ❌ |
| L2 | UI + API + データ定義あり | ⚠️ 部分的に可 |
| **L3** | 全セクション完成 + エッジケース網羅 | ✅ **実装可能** |

**L3に達しないとAIに実装を依頼してはいけない**

### Gate 1: 機能設計完了条件

| # | 条件 | 確認 |
|---|------|------|
| 1 | features/*.md が L3 レベル | ☐ |
| 2 | 受入条件が全て検証可能 | ☐ |
| 3 | エッジケースが網羅されている | ☐ |
| 4 | 設計レビューを通過した | ☐ |

---

## Phase 2: 技術設計

### 目的
共通的な技術基盤・ルールを確定する

### 成果物

| 成果物 | ファイル | 担当 |
|--------|---------|------|
| API契約（更新） | `ssot/SSOT-3_API_CONTRACT.md` | Tech Lead |
| データモデル（更新） | `ssot/SSOT-4_DATA_MODEL.md` | Tech Lead |
| 横断的関心事 | `ssot/SSOT-5_CROSS_CUTTING.md` | Tech Lead |
| 設計判断記録 | `adr/xxx.md` | Tech Lead |

### 作業内容

```
1. SSOT-3（API契約）を更新
   - 新しいエンドポイントを追加
   - エラーコードを追加
   - 権限マトリクスを更新

2. SSOT-4（データモデル）を更新
   - 新しいテーブル/カラムを追加
   - マイグレーション計画を立てる

3. SSOT-5（横断的関心事）を確認
   - 認証方式
   - エラーハンドリング方針
   - ログ出力方針
   - セキュリティ要件

4. 重要な技術判断はADRに記録
```

### Gate 2: 技術設計完了条件

| # | 条件 | 確認 |
|---|------|------|
| 1 | 全APIエンドポイントが定義されている | ☐ |
| 2 | データモデルが定義されている | ☐ |
| 3 | マイグレーション計画がある | ☐ |
| 4 | 技術レビューを通過した | ☐ |

---

## Phase 3: 実装

### 目的
仕様通りにコードを書く

### 成果物

| 成果物 | 場所 | 担当 |
|--------|------|------|
| ソースコード | `src/` | 開発者/AI |
| ユニットテスト | `tests/unit/` | 開発者/AI |
| 統合テスト | `tests/integration/` | 開発者/AI |
| マイグレーション | `migrations/` | 開発者/AI |

### AIへの実装依頼フォーマット

```markdown
## 実装依頼

### 基本情報
- 機能ID: AUTH-001
- 機能名: ログイン機能
- 優先度: P0

### 参照ドキュメント
1. docs/features/AUTH-001_login.md（必須・最初に読む）
2. docs/ssot/SSOT-5_CROSS_CUTTING.md（認証・エラー処理）
3. docs/ssot/SSOT-3_API_CONTRACT.md（API共通ルール）
4. docs/ssot/SSOT-4_DATA_MODEL.md（DB定義）

### 実装スコープ
- [x] フロントエンド（React）
- [x] バックエンド（API）
- [x] データベース（マイグレーション）
- [x] ユニットテスト
- [ ] E2Eテスト（別タスク）

### 実装順序
1. DBマイグレーション
2. APIエンドポイント
3. フロントエンドコンポーネント
4. テスト

### 注意事項
- features/AUTH-001_login.md の受入条件を全て満たすこと
- エラーハンドリングは SSOT-5 に従うこと
- APIレスポンスは SSOT-3 のフォーマットに従うこと
```

### Gate 3: 実装完了条件

| # | 条件 | 確認 |
|---|------|------|
| 1 | 全ての受入条件を満たしている | ☐ |
| 2 | ユニットテストが通過している | ☐ |
| 3 | 統合テストが通過している | ☐ |
| 4 | コードがコーディング規約に準拠 | ☐ |
| 5 | セキュリティチェック通過 | ☐ |

---

## Phase 4: レビュー

### 目的
品質を担保し、マージ可能な状態にする

### 作業内容

```
1. コードレビュー
   - REVIEW_CHECKLIST.md に従う
   - セキュリティ観点の確認
   - パフォーマンス観点の確認

2. 受入テスト
   - features/*.md の受入条件を検証
   - エッジケースの動作確認

3. ドキュメント整合性確認
   - 実装とSSOTの整合性
   - 変更があればSSOTを更新
```

### Gate 4: レビュー完了条件

| # | 条件 | 確認 |
|---|------|------|
| 1 | コードレビュー承認 | ☐ |
| 2 | 全ての受入条件が検証済み | ☐ |
| 3 | SSOTと実装の整合性確認済み | ☐ |
| 4 | マージ承認 | ☐ |

---

## Phase 5: リリース

### 目的
本番環境にデプロイし、正常動作を確認する

### 作業内容

```
1. ステージング環境でのテスト
2. 本番デプロイ
3. スモークテスト
4. モニタリング確認
5. リリースノート作成
```

### Gate 5: リリース完了条件

| # | 条件 | 確認 |
|---|------|------|
| 1 | 本番デプロイ完了 | ☐ |
| 2 | スモークテスト通過 | ☐ |
| 3 | 異常なエラーが発生していない | ☐ |
| 4 | リリースノート公開 | ☐ |

---

## イテレーション運用

### スプリント計画

```
Sprint N:
├── Phase 1-2: 機能A, B の設計（並行可能）
├── Phase 3-4: 前Sprintで設計した機能の実装・レビュー
└── Phase 5: 前Sprintで完成した機能のリリース
```

### 週次サイクル例

| 曜日 | 午前 | 午後 |
|------|------|------|
| 月 | スプリント計画 | 設計作業 |
| 火 | 設計レビュー | 実装 |
| 水 | 実装 | 実装 |
| 木 | 実装 | コードレビュー |
| 金 | レビュー対応 | リリース準備 |

---

## 緊急対応フロー

### ホットフィックス

```
1. 問題の特定・影響範囲確認
2. 最小限の修正を実施
3. テスト（最低限）
4. 緊急レビュー
5. 本番デプロイ
6. 事後的にSSOTを更新
```

**注意**: ホットフィックスでも必ず事後的にドキュメントを更新する

---

## 次に読むべきドキュメント

1. **[features/_TEMPLATE.md](./features/_TEMPLATE.md)** - 機能仕様テンプレート
2. **[02_ROLES_AND_RESPONSIBILITIES.md](./02_ROLES_AND_RESPONSIBILITIES.md)** - 役割と責任
3. **[PHASE_GATE_CHECKLIST.md](./checklists/PHASE_GATE_CHECKLIST.md)** - 全ゲート条件一覧
