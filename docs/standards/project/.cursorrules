# .cursorrules - プロジェクト指示書（Cursor用）

# ============================================================
# ⚠️ AI中断プロトコル（最優先ルール）
# ============================================================
# 不明点がある場合は即座に作業を中断し、ユーザーに質問すること。
# 推測で実装を進めることは禁止。
# 以下に該当する場合は必ず中断:
# T1: SSOTに記載がない仕様判断
# T2: SSOTの記載が曖昧
# T3: 技術的な選択肢が複数
# T4: SSOTと既存実装の矛盾
# T5: 制約・規約に未定義のケース
# T6: 影響範囲が不明
# T7: ビジネス判断が必要
# 詳細: docs/standards/21_AI_ESCALATION.md

# ============================================================
# プロジェクト概要
# ============================================================

プロダクト名: {{PRODUCT_NAME}}
概要: {{ELEVATOR_PITCH}}

# ============================================================
# 最重要ルール
# ============================================================

1. 仕様書がない機能は実装しない
2. 実装前に必ず該当の仕様書を確認する
3. 仕様と実装の乖離を見つけたら報告する
4. コア定義（docs/design/core/）は原則変更不可

# ============================================================
# 仕様書の場所
# ============================================================

このプロジェクトの仕様書は docs/ ディレクトリに格納されています。
実装する際は、必ず該当の仕様書を確認してから作業してください。

## 仕様書の参照優先順位

1. 機能仕様書: docs/design/features/
   - 共通機能: docs/design/features/common/
   - 固有機能: docs/design/features/project/
2. コア定義: docs/design/core/
   - UI/状態遷移: docs/design/core/SSOT-2_UI_STATE.md
   - API規約: docs/design/core/SSOT-3_API_CONTRACT.md
   - データモデル: docs/design/core/SSOT-4_DATA_MODEL.md
   - 横断的関心事: docs/design/core/SSOT-5_CROSS_CUTTING.md
3. 開発規約: docs/standards/
   - コーディング規約: docs/standards/CODING_STANDARDS.md
   - テスト規約: docs/standards/TESTING_STANDARDS.md
   - Git運用: docs/standards/GIT_WORKFLOW.md
4. PRD: docs/requirements/SSOT-0_PRD.md

## 機能を実装する手順

1. 対象の機能仕様書を読む
2. 関連するコア定義を確認（API→SSOT-3、DB→SSOT-4、認証/エラー→SSOT-5）
3. コーディング規約に従って実装
4. テスト規約に従ってテスト作成
5. 仕様書のテストケースに基づいて検証

# ============================================================
# 技術スタック
# ============================================================

- フレームワーク: {{FRAMEWORK}}
- 言語: {{LANGUAGE}}
- DB: {{DATABASE}}
- 認証: {{AUTH}}
- ホスティング: {{HOSTING}}
- CSS: {{CSS}}
- テスト: {{TESTING}}

# ============================================================
# コーディング規約（要約）
# ============================================================
# 詳細: docs/standards/CODING_STANDARDS.md

## 命名規則
- コンポーネント: PascalCase（LoginForm.tsx）
- 関数/変数: camelCase（handleSubmit）
- 定数: UPPER_SNAKE_CASE（MAX_RETRY_COUNT）
- ファイル: kebab-case（login-form.tsx）※コンポーネント以外
- 型/Interface: PascalCase + 接尾辞（UserResponse, AuthState）

## ディレクトリ構造
```
src/
├── app/              ← ページ / ルーティング
├── components/       ← UIコンポーネント
│   ├── ui/           ← 汎用UI（Button, Input, Modal等）
│   └── features/     ← 機能別コンポーネント
├── lib/              ← ユーティリティ / 設定
├── hooks/            ← カスタムフック
├── types/            ← 型定義
├── services/         ← 外部サービス連携
└── __tests__/        ← テスト
```

## コード品質ルール
- 1ファイル200行以内を目安
- 1関数1責務
- マジックナンバー禁止（定数化する）
- any 禁止（型を明示する）
- コメントは「なぜ」を書く（「何を」はコードで表現）
- エラーは必ずハンドリングする（握りつぶさない）
- console.log はプロダクションコードに残さない
- 環境変数はハードコードしない

## インポート順序
1. React / Next.js
2. 外部ライブラリ
3. 内部モジュール（@/）
4. 型定義
5. スタイル

## コンポーネント設計
- Presentational / Container パターンを推奨
- Props は interface で明示的に定義
- デフォルト値は分割代入で設定
- 複雑なロジックはカスタムフックに分離

# ============================================================
# API設計規約（要約）
# ============================================================
# 詳細: docs/design/core/SSOT-3_API_CONTRACT.md

## エンドポイント命名
- RESTful: /api/v1/{resource}（複数形）
- CRUD: GET(一覧), GET/:id(詳細), POST(作成), PUT/:id(更新), DELETE/:id(削除)

## レスポンス形式
成功: { data: T, meta?: { ... } }
エラー: { error: { code: string, message: string, details?: any } }

## ステータスコード
- 200: 成功
- 201: 作成成功
- 400: リクエスト不正
- 401: 未認証
- 403: 権限不足
- 404: リソース不存在
- 500: サーバーエラー

# ============================================================
# エラーハンドリング（要約）
# ============================================================
# 詳細: docs/design/core/SSOT-5_CROSS_CUTTING.md

## フロントエンド
- API呼び出しは try-catch で囲む
- ユーザーに適切なメッセージを表示
- 予期しないエラーはエラーバウンダリで捕捉

## バックエンド
- ビジネスロジック例外はカスタムエラークラス
- 全APIに統一エラーレスポンス
- 500エラーは詳細をログに出力（ユーザーには汎用メッセージ）

# ============================================================
# Git 運用（要約）
# ============================================================
# 詳細: docs/standards/GIT_WORKFLOW.md

## ブランチ
- main: 本番
- develop: 開発統合
- feature/XXX-description: 機能開発
- fix/XXX-description: バグ修正

## コミットメッセージ
<type>(<scope>): <description>

type: feat | fix | docs | style | refactor | test | chore
scope: 機能ID or モジュール名

例: feat(auth): ログイン機能を実装

# ============================================================
# テスト規約（要約）
# ============================================================
# 詳細: docs/standards/TESTING_STANDARDS.md

## テスト種類
- ユニットテスト: 全ビジネスロジック
- 統合テスト: APIエンドポイント
- E2Eテスト: クリティカルパス

## カバレッジ目標
- ビジネスロジック: 80%+
- API: 70%+
- 全体: 60%+

## テストファイル配置
- __tests__/ にミラー構造で配置
- ファイル名: {対象}.test.ts

# ============================================================
# 禁止事項
# ============================================================

❌ 仕様書にない機能を勝手に実装しない
❌ コア定義を勝手に変更しない
❌ テストなしで完了としない
❌ any 型を使わない
❌ console.log をプロダクションコードに残さない
❌ 環境変数をハードコードしない
❌ エラーを握りつぶさない
❌ 未使用のimportを残さない
❌ TODO コメントを放置しない

# ============================================================
# Cursor での作業の進め方
# ============================================================

## 新しい機能を実装する時
1. まず docs/design/features/ の該当仕様書を開いて読む
2. 関連するコア定義を確認
3. 実装を開始
4. テストを作成
5. 仕様書のチェックリストで検証

## 例: 「ログイン機能を実装して」と言われたら
1. docs/design/features/common/AUTH-001_login.md を読む
2. docs/design/core/SSOT-3_API_CONTRACT.md でAPI規約を確認
3. docs/design/core/SSOT-5_CROSS_CUTTING.md で認証仕様を確認
4. 仕様に基づいて実装
5. 仕様書のテストケースに基づいてテスト作成

## バグを修正する時
1. 関連する仕様書を確認（仕様通りの動作か確認）
2. 仕様と異なる場合 → 仕様に合わせて修正
3. 仕様が不明確な場合 → 報告（仕様書を先に更新）

## 迷った時
- 設計判断 → docs/design/adr/ を確認
- 規約 → docs/standards/ を確認
- 仕様が存在しない → 「仕様書がありません」と報告
