# 13_SSOT_AUDIT.md - SSOT 監査フォーマット

> ISO/IEC 25010 + IEEE 29148 + IEEE 1028 準拠の品質監査

---

## 準拠規格

| 規格 | 適用 |
|------|------|
| IEEE 1028:2008 | ソフトウェアレビューと監査のプロセス |
| IEEE 29148:2018 | 要件の品質特性 |
| ISO/IEC 25010:2011 | ソフトウェア品質モデル |
| ISO 9001 | 品質管理の原則 |

---

## 監査プロセス

```
┌─ SSOT完成 ──────────────────────────────────────┐
│                                                    │
│  1. 自動チェック（AI実行）                        │
│     - 全セクション存在チェック                     │
│     - RFC 2119 準拠チェック                       │
│     - TBD項目チェック                              │
│     - クロスリファレンスチェック                   │
│                                                    │
│  2. 品質スコアリング（AI実行）                    │
│     - 10カテゴリ × 配点 = 100点満点              │
│     - 各カテゴリの詳細採点                         │
│                                                    │
│  3. 指摘事項リスト（AI生成）                      │
│     - Critical / Major / Minor                     │
│     - 具体的な修正案                               │
│                                                    │
│  4. 合否判定                                       │
│     - 95点以上 → 合格 ✅                          │
│     - 90-94点 → 条件付き合格（修正後再監査）      │
│     - 89点以下 → 不合格 ❌                        │
│                                                    │
│  5. 修正→再監査（不合格の場合）                   │
│                                                    │
└────────────────────────────────────────────────────┘
```

---

## 品質スコアカード

### 10カテゴリ・100点満点

```
┌─ SSOT品質スコアカード ─────────────────────────────────────────────────┐
│                                                                        │
│  #   カテゴリ         配点   評価基準                                  │
│  ──────────────────────────────────────────────────────────────────── │
│  1   完全性            15    全12セクション（§1-§12）が記載されているか │
│  2   一貫性            15    SSOT内部で矛盾がないか                    │
│  3   明確性            10    曖昧な表現がないか（RFC 2119準拠）        │
│  4   検証可能性        10    全MUST要件にテストケースがあるか          │
│  5   追跡可能性        10    PRD→要件→テストの追跡が可能か           │
│  6   実現可能性        10    技術的に実装可能か                        │
│  7   RFC 2119準拠      10    要求レベルが適切に使い分けられているか    │
│  8   テストカバレッジ  10    正常/異常/境界値が網羅されているか       │
│  9   整合性            5     他SSOTとの整合性が取れているか           │
│  10  文書品質          5     フォーマット・可読性・命名規約           │
│                                                                        │
│  合計                 100                                              │
│  合格ライン            95                                              │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

---

## 3層対応の監査ルール

```
SSOT 3層構造（12_SSOT_FORMAT.md）に対応した監査:

Freeze状態による監査基準の変更:
────────────────────────────────
  Freeze 2 完了時点での監査（実装開始判定）:
  - CORE層: 100%完成が必須（減点なし基準）
  - CONTRACT層: 100%完成が必須
  - DETAIL層: 未完成を許容（TBDがDecision Backlogにあれば減点なし）
  - 合格ライン: 80点（CORE+CONTRACT のみで判定）

  Freeze 4 完了時点での監査（リリース判定）:
  - 全3層: 100%完成が必須
  - 合格ライン: 95点（従来通り）

TBD項目の扱い:
────────────────────────────────
  従来: TBD=0 が絶対条件
  改善:
  - CORE層のTBD: 不合格（変更なし）
  - CONTRACT層のTBD: 不合格（変更なし）
  - DETAIL層のTBD: Decision Backlog に記録済みなら許容
    → ただしリリース判定（Freeze 4）では全TBD=0 が必須

Example-driven セクションの監査:
────────────────────────────────
  §3-E 入出力例: 最低5ケース → 不足は -2点/件
  §3-F 境界値: 全データ項目 → 未定義項目は -1点/件
  §3-G 例外応答: 全エラーケース → 未定義は -2点/件
  §3-H 受け入れテスト: 全MUST要件 → 未定義は -3点/件
```

---

## カテゴリ別 詳細採点基準

### 1. 完全性（15点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| §1 文書情報 | 1 | ID、バージョン、ステータス、関連ドキュメントが全て記載 |
| §2 機能概要 | 2 | 目的、スコープ、ユーザーストーリー、フローが全て記載 |
| §3 機能要件 | 2 | MUST要件が3つ以上定義されている |
| §4 データ仕様 | 2 | 全項目に型・必須/任意・バリデーションが定義 |
| §5 API仕様 | 2 | 全エンドポイントにリクエスト/レスポンス型がある |
| §6 UI仕様 | 1 | 画面一覧、レイアウト、状態遷移がある |
| §7 ビジネスルール | 1 | 条件→アクションが明示されている |
| §8 非機能要件 | 1 | 性能目標値が数値で定義されている |
| §9 エラーハンドリング | 1 | 主要エラーケースが網羅されている |
| §10 テストケース | 1 | 正常系・異常系・境界値がある |
| §11 依存関係 | 0.5 | 依存する/される機能が明示 |
| §12 未決定事項 | 0.5 | TBD項目がゼロ（またはゼロであることが明記） |

**減点ルール:**
- セクション完全欠落: 該当配点を全額減点
- セクション記載不足: 配点の50%減点
- TBD項目が残存: §12で0点かつ全体から-5点

---

### 2. 一貫性（15点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| §3の要件と§10のテストの対応 | 5 | 全MUST要件にテストケースが存在 |
| §4のデータと§5のAPIの対応 | 3 | API型定義がデータ仕様と一致 |
| §6のUIと§3の要件の対応 | 3 | 画面操作が機能要件を実現 |
| §7のルールと§9のエラーの対応 | 2 | ルール違反時のエラーが定義 |
| §2のフローと§6の遷移の対応 | 2 | ユーザーフローと画面遷移が一致 |

**減点ルール:**
- 内部矛盾（例: §3ではMUSTだが§10にテストなし）: -3点/件
- 型の不一致（例: §4でstring、§5でnumber）: -2点/件
- フローの矛盾: -2点/件

---

### 3. 明確性（10点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| 曖昧表現の不在 | 5 | 以下の曖昧語句がないか: |
|  | | 「適切に」「必要に応じて」「など」「等」 |
|  | | 「速やかに」「十分な」「概ね」 |
| 定量的記述 | 3 | 数値で表現可能なものが数値化されているか |
| 用語の統一 | 2 | 同じ概念に同じ用語が使われているか |

**減点ルール:**
- 曖昧語句1つにつき: -1点（最大-5点）
- 「高速に処理する」→「3秒以内に応答する」に書き換え可能な箇所: -1点/件
- 用語の揺れ（「ユーザー」と「利用者」が混在等）: -1点/件

**曖昧語句の置換例:**
| ❌ 曖昧 | ✅ 明確 |
|---------|---------|
| 適切なエラーメッセージ | 「入力が不正です: [項目名]」形式のメッセージ |
| 速やかに応答する | 3秒以内にレスポンスを返す |
| 大量のデータ | 10万件以上のレコード |
| 十分なセキュリティ | TLS 1.3 + AES-256暗号化 |
| 必要に応じてログ出力 | ERROR以上のイベントを全て出力 |

---

### 4. 検証可能性（10点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| MUST要件のテスト可能性 | 5 | 全MUST要件が「はい/いいえ」で判定可能 |
| テストケースの具体性 | 3 | 前提条件・操作・期待結果が明確 |
| 受け入れ基準の明確性 | 2 | ユーザーストーリーの受け入れ基準がテスト可能 |

**減点ルール:**
- テスト不可能なMUST要件: -2点/件
- テストケースに期待結果がない: -1点/件
- 「正しく動作すること」等の曖昧な受け入れ基準: -1点/件

---

### 5. 追跡可能性（10点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| PRD→要件の追跡 | 4 | §3の各要件にPRDの根拠が記載 |
| 要件→テストの追跡 | 4 | §3の各MUST要件に対応するテストIDがある |
| 要件→UI/APIの追跡 | 2 | 要件がどの画面/APIで実現されるか明記 |

**減点ルール:**
- PRD根拠のない要件: -2点/件
- テスト対応のないMUST要件: -2点/件

---

### 6. 実現可能性（10点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| 技術スタックとの整合 | 4 | TECH_STACK.mdの技術で実装可能 |
| 外部サービスの実在性 | 3 | 利用するAPIが実在し利用可能 |
| スコープの妥当性 | 3 | 1スプリント（2週間）で実装可能な規模 |

**減点ルール:**
- 技術スタックにない技術の暗黙的要求: -2点/件
- 存在しないAPIの参照: -3点/件
- 明らかに1スプリントで収まらないスコープ: -3点

---

### 7. RFC 2119 準拠（10点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| MUSTの適切な使用 | 4 | 本当に必須のものだけがMUST |
| SHOULD/MAYの使い分け | 3 | 推奨と任意が適切に区別 |
| MUST NOTの活用 | 2 | 禁止事項が明示されている |
| 要求レベルの一貫性 | 1 | 同種の要件が同レベルで記述 |

**減点ルール:**
- 全てMUSTになっている（区別されていない）: -5点
- MUST NOTが1つもない: -1点
- 要件にレベルが付いていない: -2点/件

---

### 8. テストカバレッジ（10点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| 正常系テスト | 3 | 主要な正常フローが全てカバー |
| 異常系テスト | 4 | §9のエラーケース全てに対応するテスト |
| 境界値テスト | 3 | 数値入力、文字列長、リスト件数の境界 |

**減点ルール:**
- 正常系テスト0件: -3点
- 異常系テスト0件: -4点
- 境界値テスト0件: -3点
- エラーケースに対応するテストがない: -1点/件

---

### 9. 整合性（5点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| SSOT-2 UIとの整合 | 1 | 画面定義が既存と矛盾しない |
| SSOT-3 APIとの整合 | 1 | API規約に従っている |
| SSOT-4 データとの整合 | 1 | テーブル定義が既存と矛盾しない |
| SSOT-5 横断的関心事との整合 | 1 | 認証・エラー規約に従っている |
| 同ジャンル他SSOTとの整合 | 1 | 共通データが一致している |

**減点ルール:**
- 整合性チェック（⑨）のCritical未解決: カテゴリ全体0点
- 整合性チェック（⑨）のMajor未解決: -2点/件

---

### 10. 文書品質（5点）

| 小項目 | 配点 | 基準 |
|--------|------|------|
| フォーマット準拠 | 2 | 12_SSOT_FORMAT.md のテンプレートに従っている |
| 命名規約 | 1 | 機能ID、テストID、ルールIDが規約通り |
| 可読性 | 1 | 表が整形され、Mermaid図が正しい |
| 誤字・脱字 | 1 | 明らかな誤字がない |

---

## 監査レポートテンプレート

```markdown
# SSOT監査レポート

## 対象
| 項目 | 内容 |
|------|------|
| 機能ID | [FEAT-XXX] |
| 機能名 | [機能名] |
| 親タスク | [PT-XXX] |
| 監査日 | [YYYY-MM-DD] |
| 監査回数 | [初回 / 第2回 / ...] |

## スコア

| # | カテゴリ | 配点 | 得点 | 減点理由 |
|---|---------|------|------|---------|
| 1 | 完全性 | 15 | /15 | |
| 2 | 一貫性 | 15 | /15 | |
| 3 | 明確性 | 10 | /10 | |
| 4 | 検証可能性 | 10 | /10 | |
| 5 | 追跡可能性 | 10 | /10 | |
| 6 | 実現可能性 | 10 | /10 | |
| 7 | RFC 2119準拠 | 10 | /10 | |
| 8 | テストカバレッジ | 10 | /10 | |
| 9 | 整合性 | 5 | /5 | |
| 10 | 文書品質 | 5 | /5 | |
| **合計** | | **100** | **/100** | |

## 判定

| 判定 | 条件 |
|------|------|
| ✅ 合格 | 95点以上 AND TBD=0 AND Critical=0 |
| ⚠️ 条件付き合格 | 90-94点 → 指摘修正後に再監査 |
| ❌ 不合格 | 89点以下 → 該当セクション作り直し |

**今回の判定: [合格/条件付き合格/不合格]**

## 指摘事項

| # | 重大度 | カテゴリ | セクション | 指摘内容 | 修正案 |
|---|--------|---------|----------|---------|-------|
| 1 | Critical | | §X | | |
| 2 | Major | | §X | | |
| 3 | Minor | | §X | | |

### 重大度の定義

| 重大度 | 定義 | 対応 |
|--------|------|------|
| Critical | 実装不可能、または重大な矛盾 | 必ず修正。修正なしでは合格不可 |
| Major | 品質に重大な影響 | 修正推奨。2件以上で条件付き合格 |
| Minor | 品質向上の提案 | 対応任意 |

## 絶対条件チェック

| 条件 | 結果 |
|------|------|
| TBD項目がゼロ | ✅ / ❌（残存: X件） |
| Critical指摘がゼロ | ✅ / ❌（残存: X件） |
| 整合性チェックのCritical/Majorがゼロ | ✅ / ❌ |

**絶対条件を1つでも満たさない場合、スコアに関係なく不合格**
```

---

## AIへの監査実行指示

```
以下のSSOTを監査してください。

対象: [機能ID: 機能名]
SSOT: [SSOTの全文をペースト]

監査基準: 13_SSOT_AUDIT.md に従い、
10カテゴリ・100点満点でスコアリングしてください。

各カテゴリについて:
1. 得点を算出
2. 減点理由を具体的に記載
3. 修正案を提示

絶対条件もチェックしてください:
- TBD項目がゼロか
- Critical指摘がゼロか

整合性チェック対象:
[SSOT-0, SSOT-1, SSOT-2, SSOT-3, SSOT-4, SSOT-5 をペーストまたは参照]

監査レポートを出力してください。
```

---

## 再監査フロー

```
不合格 or 条件付き合格の場合:

1. 指摘事項の修正
   - Critical: 必ず修正
   - Major: 修正推奨
   - Minor: 対応任意

2. 修正箇所の明示
   「以下の指摘を修正しました:
    #1: §3 FR-002 の記述を明確化
    #2: §10 に境界値テストを追加」

3. 再監査の実行
   → 修正箇所のみではなく全体を再採点
   → 修正によって新たな矛盾が生じていないか確認

4. 95点以上 → 合格 ✅
   95点未満 → 再度修正→再監査（最大3回）
```

---

## 変更履歴

| 日付 | 変更内容 | 変更者 |
|------|---------|-------|
| | 初版作成 | |
| | SSOT 3層対応の監査ルール追加（Freeze状態別判定、DETAIL層TBD許容、Example-driven監査） | |
