# SSOT: ミエルファイル - 変更と履歴がミエル

**ステータス**: 確定  
**最終更新**: 2026-01-02  
**承認者**: 経営・マーケティング担当  
**実装予定**: Year 2 Q2〜

---

## 🎯 このドキュメントの位置づけ

このドキュメントは **「ミエルファイル」の機能設計における唯一の正（Single Source of Truth）** です。

- すべての実装はこのSSOTに基づく
- 仕様変更はこのドキュメントの更新から始める
- M&A戦略（SSOT_EXIT_STRATEGY.md）と整合させる

---

## 1. プロダクト定義

### 1-1. コンセプト

```
┌─────────────────────────────────────────────────────────────┐
│                                                              │
│  📁 ミエルファイル                                            │
│  「変更と履歴がミエル」                                       │
│                                                              │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                              │
│  現場最大のペイン:                                            │
│  「変更点がわからない」「変更が共有されない」                  │
│                                                              │
│  解決策:                                                      │
│  画像・資料・図面の変更を自動検知し、                         │
│  設計→管理→職人の全員に確実に届ける                          │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 1-2. スコープ

| 区分 | 内容 |
|------|------|
| **やること** | 変更検知、完全共有、施工履歴管理 |
| **やらないこと** | 一般的な図面管理、CAD連携、図面編集 |

#### ✅ やること（スコープ内）

1. **変更の自動検知**
   - 新旧ファイルの差分検出
   - 変更箇所のハイライト表示
   - 変更内容のサマリー生成

2. **設計→管理→職人への完全共有**
   - 変更時の自動通知
   - 関係者全員への同時配信
   - 確認状況の可視化
   - 未確認者へのリマインド

3. **施工履歴のタイムライン管理**
   - 変更履歴の時系列表示
   - 施工写真との紐付け
   - 「誰が・いつ・何を確認したか」のログ

#### ❌ やらないこと（スコープ外）

- 図面の閲覧・共有（ANDPADが持っている）
- ピン・マーキング機能（ANDPADが持っている）
- CADファイルの編集・変換
- 図面作成ツール

---

## 2. ターゲットユーザー

### 2-1. ペルソナ

```
┌─────────────────────────────────────────────────────────────┐
│  設計→管理→職人 の情報伝達チェーン                           │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  👤 設計者（設計事務所・メーカー）                            │
│     └─ 図面・仕様書を作成・変更する人                        │
│     └─ 変更を「確実に伝えたい」                              │
│                                                              │
│  👤 管理者（元請け・現場監督）                                │
│     └─ 変更を受け取り、関係者に展開する人                    │
│     └─ 「伝達漏れを防ぎたい」                                │
│                                                              │
│  👤 職長（下請け・専門工事業者）                              │
│     └─ 職人に指示を出す人                                    │
│     └─ 「最新情報を把握したい」                              │
│                                                              │
│  👤 職人（実際に施工する人）                                  │
│     └─ 図面を見て施工する人                                  │
│     └─ 「変更を知らずに作業したくない」                      │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 2-2. 解決するペイン

| ペイン | 現状 | ミエルファイルで解決 |
|--------|------|-------------------|
| 変更点がわからない | 図面を見比べて目視確認 | AIが自動で差分検出 |
| 変更が共有されない | 電話・LINE・FAXで個別連絡 | 全員に同時自動通知 |
| 誰が確認したかわからない | 確認状況が見えない | 確認ステータスを可視化 |
| 「聞いてない」問題 | 証跡がない | 全履歴をログ保存 |
| 施工履歴が追えない | 紙・バラバラのファイル | タイムラインで一元管理 |

---

## 3. 機能詳細

### 3-1. 変更の自動検知

```
┌─────────────────────────────────────────────────────────────┐
│  機能1: 変更の自動検知                                        │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  【入力】                                                     │
│  ・新しいファイルをアップロード（PDF/画像/Office）            │
│  ・または既存ファイルを更新                                   │
│                                                              │
│  【処理】                                                     │
│  ・新旧ファイルの画像比較（ピクセル差分）                     │
│  ・OCRでテキスト抽出→テキスト差分                            │
│  ・AI（将来）で意味的な変更検出                               │
│                                                              │
│  【出力】                                                     │
│  ・変更箇所のハイライト表示                                   │
│  ・変更サマリー（テキスト）                                   │
│  ・変更の重要度（大/中/小）                                   │
│                                                              │
│  【対応ファイル形式】                                         │
│  ・PDF（図面、仕様書）                                        │
│  ・画像（JPG/PNG - 写真、スキャン図面）                       │
│  ・Office（Excel/Word - 指示書）                              │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

#### 差分表示UI（イメージ）

```
┌─────────────────────────────────────────────────────────────┐
│  📄 配管図面_v2.pdf                        変更検知: 3箇所   │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌─────────────────┐    ┌─────────────────┐                 │
│  │    v1（旧）     │    │    v2（新）     │                 │
│  │                 │    │                 │                 │
│  │    ┌──────┐    │    │    ┌──────┐    │                 │
│  │    │      │    │ →  │    │▓▓▓▓▓▓│    │ ← 変更箇所      │
│  │    └──────┘    │    │    └──────┘    │                 │
│  │                 │    │                 │                 │
│  └─────────────────┘    └─────────────────┘                 │
│                                                              │
│  【変更サマリー】                                             │
│  ・配管ルート変更（A区画→B区画経由）                         │
│  ・配管径変更（50A→65A）                                     │
│  ・バルブ追加（1箇所）                                       │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 3-2. 設計→管理→職人への完全共有

```
┌─────────────────────────────────────────────────────────────┐
│  機能2: 完全共有システム                                      │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  【関係者グループ設定】                                       │
│  ・ファイル/フォルダごとに関係者を設定                        │
│  ・役割（設計/管理/職長/職人）ごとにグループ化                │
│  ・部門・会社をまたいだ共有が可能                             │
│                                                              │
│  【自動通知】                                                 │
│  ・変更検知時に全関係者へ同時通知                             │
│  ・通知方法: アプリ通知 / メール / LINE（将来）               │
│  ・変更サマリーを通知に含める                                 │
│                                                              │
│  【確認ステータス】                                           │
│  ・未確認 / 確認済み のステータス管理                         │
│  ・確認日時・確認者のログ                                     │
│  ・コメント追加機能                                           │
│                                                              │
│  【リマインド】                                               │
│  ・未確認者への自動リマインド（設定可能）                     │
│  ・リマインド間隔: 1時間後 / 1日後 / 3日後                    │
│  ・管理者への未確認者レポート                                 │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

#### 確認状況UI（イメージ）

```
┌─────────────────────────────────────────────────────────────┐
│  📄 配管図面_v2.pdf                 確認状況: 3/5名 (60%)    │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  【設計】                                                     │
│  ✅ 田中設計事務所 田中太郎    01/10 14:30 確認済み           │
│                                                              │
│  【管理】                                                     │
│  ✅ 〇〇建設 山田次郎          01/10 15:00 確認済み           │
│     └─ コメント: 了解しました。職人に展開します。            │
│                                                              │
│  【職長】                                                     │
│  ✅ △△電気 佐藤三郎           01/10 16:30 確認済み           │
│                                                              │
│  【職人】                                                     │
│  ⚠️ △△電気 鈴木四郎           未確認 (2日経過)  [リマインド送信] │
│  ⚠️ △△電気 高橋五郎           未確認 (2日経過)  [リマインド送信] │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 3-3. 施工履歴のタイムライン管理

```
┌─────────────────────────────────────────────────────────────┐
│  機能3: 施工履歴タイムライン                                  │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  【タイムライン表示】                                         │
│  ・ファイル/現場ごとの時系列履歴                              │
│  ・変更・アップロード・確認イベントを統合表示                 │
│  ・フィルタ: 期間 / 担当者 / ファイル種別                     │
│                                                              │
│  【施工写真連携】                                             │
│  ・施工写真をタイムラインに追加                               │
│  ・図面変更→施工→完了写真の流れを可視化                      │
│  ・位置情報・日時の自動記録                                   │
│                                                              │
│  【証跡管理】                                                 │
│  ・全操作ログの保存（改ざん防止）                             │
│  ・監査用レポート出力                                         │
│  ・トラブル時の原因追跡                                       │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

#### タイムラインUI（イメージ）

```
┌─────────────────────────────────────────────────────────────┐
│  🏗️ ○○ホテル新館 配管工事                    タイムライン   │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  2026/01/05 09:00                                            │
│  📄 配管図面_v1.pdf アップロード                              │
│     └─ 設計: 田中設計事務所                                  │
│                                                              │
│  2026/01/10 14:30                                            │
│  🔄 配管図面_v2.pdf 変更検知 (3箇所)                          │
│     └─ 変更: 配管ルート変更、配管径変更、バルブ追加          │
│     └─ 確認済み: 3/5名                                       │
│                                                              │
│  2026/01/12 10:00                                            │
│  📸 施工写真 5枚 アップロード                                 │
│     └─ 職人: 鈴木四郎                                        │
│     └─ コメント: 配管施工完了（A区画）                       │
│                                                              │
│  2026/01/15 11:00                                            │
│  🔄 配管図面_v3.pdf 変更検知 (1箇所)                          │
│     └─ 変更: 追加配線（発注者要望）                          │
│     └─ 確認済み: 5/5名 ✅ 全員確認済み                       │
│                                                              │
│  2026/01/18 16:00                                            │
│  📸 施工写真 3枚 アップロード                                 │
│     └─ 職人: 高橋五郎                                        │
│     └─ コメント: 追加配線施工完了                            │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. 技術アーキテクチャ

### 4-1. システム構成

```
┌─────────────────────────────────────────────────────────────┐
│  ミエルファイル システム構成                                  │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  【フロントエンド】                                           │
│  ・Nuxt 3 + Vue 3（既存基盤を踏襲）                          │
│  ・ファイルビューア（PDF.js / 画像表示）                      │
│  ・差分オーバーレイ表示                                       │
│                                                              │
│  【バックエンド】                                             │
│  ・Nuxt Server API（既存基盤を踏襲）                         │
│  ・ファイルストレージ（S3互換 / ローカル）                    │
│  ・差分検出エンジン                                           │
│                                                              │
│  【差分検出】                                                 │
│  ・Phase 1: 画像ベース差分（ImageMagick / Sharp）            │
│  ・Phase 2: OCR + テキスト差分（Tesseract）                  │
│  ・Phase 3: AI差分（OpenAI Vision / Claude）                 │
│                                                              │
│  【通知】                                                     │
│  ・アプリ内通知（既存基盤）                                   │
│  ・メール通知（SendGrid / SES）                              │
│  ・LINE通知（将来 - LINE Notify）                            │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 4-2. データモデル

```
┌─────────────────────────────────────────────────────────────┐
│  データモデル（既存スキーマ拡張 - metadata活用）              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  MielFile（ファイル）                                         │
│  ├─ id: UUID                                                 │
│  ├─ organizationId: UUID（マルチテナント）                   │
│  ├─ name: string（ファイル名）                               │
│  ├─ version: number（バージョン番号）                        │
│  ├─ storageUrl: string（S3等のURL）                          │
│  ├─ fileType: string（pdf/image/office）                     │
│  ├─ parentId: UUID?（前バージョンへの参照）                  │
│  ├─ metadata: Json                                           │
│  │   ├─ changeDetected: boolean                              │
│  │   ├─ changeSummary: string                                │
│  │   ├─ changeLocations: array                               │
│  │   └─ diffImageUrl: string                                 │
│  └─ createdAt / updatedAt                                    │
│                                                              │
│  FileShare（共有設定）                                        │
│  ├─ id: UUID                                                 │
│  ├─ fileId: UUID                                             │
│  ├─ userId: UUID                                             │
│  ├─ role: string（設計/管理/職長/職人）                      │
│  └─ createdAt                                                │
│                                                              │
│  FileConfirmation（確認ステータス）                           │
│  ├─ id: UUID                                                 │
│  ├─ fileId: UUID                                             │
│  ├─ userId: UUID                                             │
│  ├─ confirmedAt: DateTime?                                   │
│  ├─ comment: string?                                         │
│  └─ metadata: Json                                           │
│                                                              │
│  FileHistory（履歴イベント）                                  │
│  ├─ id: UUID                                                 │
│  ├─ fileId: UUID?                                            │
│  ├─ siteId: UUID（現場ID）                                   │
│  ├─ eventType: string（upload/change/confirm/photo）         │
│  ├─ userId: UUID                                             │
│  ├─ metadata: Json                                           │
│  └─ createdAt                                                │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 5. 実装ロードマップ

### 5-1. フェーズ分け

| フェーズ | 期間 | 内容 | 優先度 |
|---------|------|------|--------|
| **MVP** | Year 2 Q2 | 基本機能（ファイル管理・手動差分・通知） | ★★★ |
| **Phase 1** | Year 2 Q3 | 自動差分検出（画像ベース） | ★★★ |
| **Phase 2** | Year 2 Q4 | 施工履歴タイムライン | ★★☆ |
| **Phase 3** | Year 3 | AI差分検出・影響分析 | ★☆☆ |

### 5-2. MVP機能

```
┌─────────────────────────────────────────────────────────────┐
│  MVP（Year 2 Q2）                                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ✅ ファイルアップロード・バージョン管理                      │
│  ✅ 関係者グループ設定                                        │
│  ✅ アップロード時の自動通知                                  │
│  ✅ 確認ステータス管理（確認ボタン）                          │
│  ✅ 基本的なタイムライン表示                                  │
│  ⚠️ 差分表示は手動（新旧を並べて表示）                        │
│                                                              │
│  ❌ 自動差分検出（Phase 1）                                   │
│  ❌ リマインド機能（Phase 1）                                 │
│  ❌ 施工写真連携（Phase 2）                                   │
│  ❌ AI差分検出（Phase 3）                                     │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 6. M&A戦略との整合

### 6-1. ANDPADへの価値提案

| 要素 | 内容 |
|------|------|
| **差別化機能** | 変更の自動検知（ANDPADにない） |
| **ペイン解決** | 「変更がわからない」問題の解消 |
| **シナジー** | ANDPAD図面 + ミエルファイル = 最強の図面管理 |
| **技術資産** | 差分検出エンジン、確認追跡システム |

### 6-2. 買収時のポジショニング

```
ANDPADの現状:
・図面閲覧・共有 ✅
・ピン・マーキング ✅
・変更自動検知 ❌ ← ミエルファイルが補完
・確認状況追跡 △  ← ミエルファイルが強化
```

---

## 📝 改定履歴

| 日付 | 内容 | 承認者 |
|------|------|--------|
| 2026-01-02 | 初版作成（M&A戦略に基づく再定義） | 経営・マーケティング担当 |

---

## 🔗 関連ドキュメント

- [SSOT_EXIT_STRATEGY.md](./SSOT_EXIT_STRATEGY.md) - EXIT戦略・M&A
- [SSOT_BRAND.md](./SSOT_BRAND.md) - ブランドガイドライン
- [SSOT_GENBA_WEEK.md](./SSOT_GENBA_WEEK.md) - ミエルボード機能仕様

---

**このSSOTは「ミエルファイル」の機能設計における唯一の正です。**
