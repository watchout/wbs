# SSOT: ミエルファイル

> **Status:** 構想段階（Phase 4 予定）  
> **Last Updated:** 2024-12-19  
> **Owner:** 設計AI / プロダクトオーナー

---

## 1. 製品概要

### 1.1 製品名
**ミエルファイル**（ファイルがミエル）

### 1.2 キャッチコピー
```
「あの図面どこ？」を、ゼロにする。
```

### 1.3 製品ポジション

| 製品 | 何がミエル | 解決する「見えない」 |
|-----|-----------|-------------------|
| ミエルボード | 予定 | 誰が・どこで・何をしているか |
| ミエルストック | 在庫 | 何が・どこに・いくつあるか |
| ミエルドライブ | 車両 | 誰が・どの車で・どう動いたか |
| **ミエルファイル** | **ファイル** | **どの図面が・どこにあるか・何が変わったか** |

### 1.4 ターゲットユーザー
- 電気工事会社
- 設備工事会社
- 建設会社（小〜中規模）
- 設備管理会社
- リフォーム会社

---

## 2. 解決する課題

### 2.1 課題一覧

| ID | 課題 | 現状 | 影響 |
|----|------|------|------|
| FILE-P01 | 図面のバージョン管理 | 「図面_最終版_v3_修正2.pdf」が乱立 | 古い図面で施工→手戻り |
| FILE-P02 | 図面の変更点がわからない | 目視で新旧比較 | 見落とし→施工ミス |
| FILE-P03 | 図面の共有が面倒 | メール添付、重くて送れない | 下請けに最新版が届かない |
| FILE-P04 | 現場写真がどこにあるかわからない | スマホ/PC/クラウドに散在 | 報告書作成に時間がかかる |
| FILE-P05 | 過去資料の検索ができない | フォルダを順番に開いて探す | 1時間かけて見つからない |
| FILE-P06 | 現場ごとの資料が整理されていない | 個人のPCに保存 | 担当者が辞めると資料消失 |

### 2.2 課題の深堀り

#### 図面のバージョン地獄
```
現状のフォルダ構造:
└── ◯◯ホテル新館工事/
    ├── 図面/
    │   ├── 電気配線図.pdf
    │   ├── 電気配線図_v2.pdf
    │   ├── 電気配線図_v2_修正.pdf
    │   ├── 電気配線図_v3_最終.pdf
    │   ├── 電気配線図_v3_最終_0515修正.pdf  ← どれが最新？
    │   └── 電気配線図_確定版.pdf
```

#### 変更点の追跡が困難
- 設計事務所から「図面変更しました」と来る
- どこが変わったのかわからない
- 全ページ目視チェック → 見落とし発生

#### 写真の行方不明
- 現場担当者のスマホに残ったまま
- LINEで送った写真が流れてしまう
- 退職時にデータも消える

---

## 3. 製品機能

### 3.1 コア機能

| ID | 機能 | 説明 | 優先度 |
|----|------|------|--------|
| FILE-F01 | 現場別ファイル管理 | 現場ごとにファイルを自動整理 | P0 |
| FILE-F02 | 自動バージョン管理 | 同名ファイルをアップロード→履歴として保存 | P0 |
| FILE-F03 | **AI差分検出** | 図面の変更箇所をAIが検出・箇条書き | P0 |
| FILE-F04 | URL共有 | ファイルをURL化、閲覧権限設定可能 | P0 |
| FILE-F05 | **AI検索** | 「◯◯ホテルの配線図」で検索 | P1 |
| FILE-F06 | 写真自動タグ付け | 撮影日時・位置情報・AI解析で自動分類 | P1 |
| FILE-F07 | スマホアップロード | 現場から直接アップロード | P0 |
| FILE-F08 | 閲覧ログ | 誰がいつ見たかを記録 | P2 |
| FILE-F09 | 期限付きリンク | 下請け向け、7日で自動失効 | P1 |
| FILE-F10 | コメント・マーカー | 図面上にコメントを追加 | P2 |

### 3.2 AI機能詳細

#### AI差分検出（FILE-F03）

```
入力: 図面A（旧）、図面B（新）
     ↓
処理: 画像比較 + テキスト抽出 + AI解析
     ↓
出力:
┌─────────────────────────────────────────┐
│ 📋 変更点サマリー（v2 → v3）           │
│                                        │
│ 1. 2階廊下のコンセント位置を変更       │
│    - 旧: 壁面中央                      │
│    - 新: 壁面右端から50cm              │
│                                        │
│ 2. 分電盤の容量を変更                  │
│    - 旧: 40A                           │
│    - 新: 60A                           │
│                                        │
│ 3. 新規追加: 3階トイレに換気扇追加     │
└─────────────────────────────────────────┘
```

#### AI検索（FILE-F05）

```
ユーザー: 「去年の◯◯ホテルの竣工写真ある？」
     ↓
AI: 「2023年11月に撮影された◯◯ホテル新館の
     竣工写真が15枚あります。表示しますか？」
```

**技術構成:**
- ベクトルDB（pgvector / Pinecone）
- OpenAI Embeddings or Gemini Embeddings
- OCR（Google Cloud Vision / Tesseract）
- 画像解析（GPT-4V / Gemini Pro Vision）

### 3.3 NotebookLM連携（将来構想）

```
ミエルファイル ─同期→ Google Drive ─連携→ NotebookLM
                                      ↓
                              「この資料について質問」
```

または自社RAG基盤で同等機能を実装

---

## 4. ユーザーストーリー

### 4.1 図面管理

```
As a 工事責任者
I want 図面をアップロードするだけで自動でバージョン管理される
So that 「どれが最新？」で悩まない
```

```
As a 現場監督
I want 新しい図面が来たら変更点を自動で教えてほしい
So that 見落としによる施工ミスを防げる
```

```
As a 事務担当者
I want 下請けに図面をURLで共有したい
So that メール添付の手間とセキュリティリスクを減らせる
```

### 4.2 写真・資料管理

```
As a 現場担当者
I want 現場でスマホで撮った写真を自動で現場フォルダに入れてほしい
So that あとで整理する手間がなくなる
```

```
As a 報告書作成者
I want 「◯◯現場の着工前写真」と検索したい
So that 報告書作成時間を短縮できる
```

---

## 5. 画面構成（案）

### 5.1 メイン画面

```
┌─────────────────────────────────────────────────────┐
│ ミエルファイル                    🔍 検索...   [アップロード] │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 📁 現場一覧                                         │
│ ├── 📁 ◯◯ホテル新館工事（2024）                    │
│ │   ├── 📁 図面（12件）                            │
│ │   ├── 📁 写真（156件）                           │
│ │   └── 📁 資料（8件）                             │
│ │                                                  │
│ ├── 📁 △△ビル改修工事（2024）                     │
│ │   └── ...                                        │
│ │                                                  │
│ └── 📁 □□マンション（2023）                       │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 5.2 図面詳細画面

```
┌─────────────────────────────────────────────────────┐
│ ← 戻る    電気配線図.pdf                            │
├─────────────────────────────────────────────────────┤
│                                                     │
│ ┌─────────────────────────────────────────────────┐ │
│ │                                                 │ │
│ │              [ 図面プレビュー ]                 │ │
│ │                                                 │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ バージョン履歴                                      │
│ ┌───────────────────────────────────────────────┐   │
│ │ v3 (最新) 2024/12/15 田中がアップロード        │   │
│ │   📋 変更点: コンセント位置変更、分電盤容量変更 │   │
│ ├───────────────────────────────────────────────┤   │
│ │ v2 2024/12/01 佐藤がアップロード              │   │
│ ├───────────────────────────────────────────────┤   │
│ │ v1 2024/11/15 初版                            │   │
│ └───────────────────────────────────────────────┘   │
│                                                     │
│ [🔗 共有リンク作成] [📥 ダウンロード] [🔍 差分を見る] │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 5.3 AI差分ビュー

```
┌─────────────────────────────────────────────────────┐
│ 図面比較: v2 → v3                                   │
├─────────────────────────────────────────────────────┤
│                                                     │
│ ┌────────────────┐  ┌────────────────┐              │
│ │   v2（旧）     │  │   v3（新）     │              │
│ │                │  │                │              │
│ │  [🔴 変更箇所  │  │  [🟢 変更箇所  │              │
│ │   ハイライト]  │  │   ハイライト]  │              │
│ │                │  │                │              │
│ └────────────────┘  └────────────────┘              │
│                                                     │
│ 📋 AIによる変更点サマリー                           │
│ ┌─────────────────────────────────────────────────┐ │
│ │ 1. 2階廊下のコンセント位置を変更                │ │
│ │    - 旧: 壁面中央 → 新: 壁面右端から50cm        │ │
│ │                                                 │ │
│ │ 2. 分電盤の容量を変更                           │ │
│ │    - 旧: 40A → 新: 60A                          │ │
│ │                                                 │ │
│ │ 3. 新規追加: 3階トイレに換気扇追加              │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ [📤 下請けに変更点を共有]                           │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 6. 料金プラン（案）

### 6.1 価格設定方針

- BOARD/STOCKと同等の価格帯
- ストレージ容量ベースの課金も検討

### 6.2 プラン案

| プラン | ユーザー数 | ストレージ | AI機能 | 月額料金 |
|-------|----------|-----------|--------|---------|
| スターター | 〜10名 | 50GB | AI検索 100回/月 | ¥9,800 |
| ビジネス | 〜30名 | 200GB | AI検索 500回/月、差分検出 | ¥19,800 |
| プロフェッショナル | 〜100名 | 1TB | AI無制限 | ¥39,800 |
| エンタープライズ | 無制限 | 無制限 | 全機能 | 要相談 |

---

## 7. 技術要件

### 7.1 アーキテクチャ概要

```
┌──────────────────────────────────────────────────────┐
│                    フロントエンド                     │
│                  (Nuxt 3 / Vue 3)                    │
└──────────────────────────────────────────────────────┘
                          │
                          ▼
┌──────────────────────────────────────────────────────┐
│                    APIサーバー                        │
│                   (Nitro / Node)                     │
└──────────────────────────────────────────────────────┘
          │                    │                    │
          ▼                    ▼                    ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  PostgreSQL  │    │ ベクトルDB   │    │  ストレージ  │
│  (メタデータ)│    │ (pgvector)   │    │ (S3/R2/GCS) │
└──────────────┘    └──────────────┘    └──────────────┘
                          │
                          ▼
┌──────────────────────────────────────────────────────┐
│                    AI処理パイプライン                 │
├──────────────────────────────────────────────────────┤
│ 1. OCR (Google Cloud Vision)                         │
│ 2. 画像解析 (GPT-4V / Gemini Pro Vision)            │
│ 3. Embeddings生成 (OpenAI / Gemini)                 │
│ 4. 差分検出 (画像比較 + LLM解析)                    │
└──────────────────────────────────────────────────────┘
```

### 7.2 主要技術

| 領域 | 技術 |
|-----|------|
| フロントエンド | Nuxt 3, Vue 3, TailwindCSS |
| バックエンド | Nitro, Prisma |
| データベース | PostgreSQL + pgvector |
| ストレージ | Cloudflare R2 / AWS S3 |
| OCR | Google Cloud Vision API |
| 画像解析 | GPT-4V / Gemini Pro Vision |
| ベクトル検索 | pgvector / Pinecone |
| 差分検出 | ImageMagick + LLM |

### 7.3 Prismaスキーマ拡張（案）

```prisma
model File {
  id             String   @id @default(cuid())
  organizationId String
  siteId         String?  // 現場ID
  
  name           String   // ファイル名
  type           FileType // DRAWING, PHOTO, DOCUMENT
  mimeType       String
  size           Int      // バイト数
  
  storagePath    String   // S3/R2のパス
  thumbnailPath  String?  // サムネイル
  
  version        Int      @default(1)
  parentFileId   String?  // 前バージョンのID
  
  // AI解析結果
  ocrText        String?  // OCR抽出テキスト
  aiTags         String[] // AIによる自動タグ
  embedding      Unsupported("vector(1536)")? // ベクトル
  
  // メタデータ
  takenAt        DateTime? // 撮影日時（写真）
  location       Json?     // GPS座標
  
  uploadedBy     String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  organization   Organization @relation(fields: [organizationId], references: [id])
  site           Site?        @relation(fields: [siteId], references: [id])
  
  @@index([organizationId])
  @@index([siteId])
}

model FileShare {
  id        String   @id @default(cuid())
  fileId    String
  token     String   @unique
  expiresAt DateTime?
  password  String?
  viewCount Int      @default(0)
  createdAt DateTime @default(now())
  
  file      File     @relation(fields: [fileId], references: [id])
}

model FileDiff {
  id          String   @id @default(cuid())
  oldFileId   String
  newFileId   String
  diffSummary String   // AIによる差分サマリー
  diffDetails Json     // 詳細な差分情報
  createdAt   DateTime @default(now())
  
  oldFile     File     @relation("OldFile", fields: [oldFileId], references: [id])
  newFile     File     @relation("NewFile", fields: [newFileId], references: [id])
}

enum FileType {
  DRAWING   // 図面
  PHOTO     // 写真
  DOCUMENT  // その他資料
}
```

---

## 8. 競合分析

### 8.1 競合サービス

| サービス | 強み | 弱み | 価格帯 |
|---------|------|------|-------|
| **Procore** | 総合建設管理 | 複雑、高価格、大規模向け | 高 |
| **SPIDERPLUS** | 図面管理特化、日本製 | 高価格、導入ハードル高い | 高 |
| **Photoruction** | 写真管理特化 | 図面管理弱い | 中〜高 |
| **PlanGrid** | 図面マークアップ | 海外サービス、日本語弱い | 中 |
| **Dropbox/Box** | 汎用、安い | 現場特化じゃない | 低 |
| **Google Drive** | 無料〜安い | 検索弱い、整理が大変 | 低 |

### 8.2 ミエルファイルの差別化

```
┌─────────────────────────────────────────────────────┐
│              ミエルファイルのポジション                  │
├─────────────────────────────────────────────────────┤
│                                                     │
│  高機能・複雑                                        │
│      │                                              │
│      │  Procore    SPIDERPLUS                       │
│      │      ●          ●                            │
│      │                                              │
│ 安い─┼───────────────────────────────────高い       │
│      │                                              │
│      │      ★ ミエルファイル                            │
│      │  「ちょうどいい」                            │
│      │                                              │
│      │  Dropbox ●      ● Photoruction               │
│      │                                              │
│  シンプル・使いやすい                                │
│                                                     │
└─────────────────────────────────────────────────────┘
```

**差別化ポイント:**
1. **AI差分検出** - 他社にない機能
2. **AI検索** - NotebookLM級の検索体験
3. **現場ミエルAI連携** - 他製品と横断検索
4. **気軽な価格** - 小規模事業者でも導入可能
5. **日本語ネイティブ** - 日本の現場に最適化

---

## 9. ロードマップ

### 9.1 フェーズ分け

| Phase | 内容 | 目標時期 |
|-------|------|---------|
| Phase 0 | SSOT作成、技術検証 | 現在 |
| Phase 1 | MVP（ファイル管理 + URL共有） | TBD |
| Phase 2 | AI検索 | TBD |
| Phase 3 | AI差分検出 | TBD |
| Phase 4 | 高度な機能（コメント、ワークフロー等） | TBD |

### 9.2 MVP機能

- 現場別フォルダ管理
- ファイルアップロード（Web/スマホ）
- 自動バージョン管理
- URL共有（期限付き）
- 基本検索（ファイル名、タグ）

---

## 10. 未解決課題

| ID | 課題 | 検討事項 |
|----|------|---------|
| OPEN-01 | 図面フォーマット対応 | PDF、CAD（DWG/DXF）、画像、どこまで対応？ |
| OPEN-02 | ストレージコスト | 大量の図面・写真でコストが嵩む可能性 |
| OPEN-03 | AI精度 | 図面の差分検出精度はどこまで出せるか |
| OPEN-04 | 既存データ移行 | 既存のDropbox/NASからの移行パス |
| OPEN-05 | オフライン対応 | 現場でネットがない場合の対応 |

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2024-12-19 | v0.1 | 初版作成（構想段階） |


