# チャットbot課金プラン設計

## 概要
ミエルボードのAIチャットbot機能に対する3段階の課金プランを設計する。
現在の課金システムを拡張し、月間チャット使用量に基づいた柔軟な料金体系を提供する。

## プラン設計

### 🥉 ライトプラン（小規模企業向け）
- **基本料金**: 4,980円/月
- **チャット回数**: 30回/月
- **基本アカウント数**: 5名
- **追加アカウント**: 500円/名・月
- **対象**: 小規模チーム、個人事業主

### 🥈 スタンダードプラン（中規模企業向け）
- **基本料金**: 9,800円/月
- **チャット回数**: 100回/月
- **基本アカウント数**: 15名
- **追加アカウント**: 400円/名・月
- **対象**: 中規模企業、部署単位

### 🥇 プレミアムプラン（大規模企業向け）
- **基本料金**: 19,800円/月
- **チャット回数**: 300回/月
- **基本アカウント数**: 50名
- **追加アカウント**: 300円/名・月
- **対象**: 大規模企業、全社導入

## 超過料金

### チャット超過分
- **単価**: 100円/回
- **計算**: 月末に超過回数×100円を請求
- **制限**: 超過200%まで（以降は翌月まで利用停止）

### アカウント超過分
- **単価**: プラン別の追加アカウント単価
- **計算**: 月間最大利用アカウント数で計算

## 技術実装

### データベース拡張

#### BillingSettings テーブル拡張
```sql
ALTER TABLE billing_settings ADD COLUMN plan_type VARCHAR(20) DEFAULT 'standard';
ALTER TABLE billing_settings ADD COLUMN chat_credits_included INT DEFAULT 100;
ALTER TABLE billing_settings ADD COLUMN chat_overage_price INT DEFAULT 100;
ALTER TABLE billing_settings ADD COLUMN max_overage_percentage INT DEFAULT 200;
```

#### AIUsage テーブル拡張
```sql
ALTER TABLE ai_usage ADD COLUMN usage_type VARCHAR(20) DEFAULT 'chat';
ALTER TABLE ai_usage ADD COLUMN cost_per_use INT DEFAULT 0;
```

### プラン管理機能

#### 1. プラン選択・変更
- 管理画面でのプラン選択UI
- 月の途中でのプラン変更時の日割り計算
- プランダウングレード時の制限事項

#### 2. 使用量モニタリング
- リアルタイム使用量表示
- 残り回数の警告機能
- 超過前の通知システム

#### 3. 請求管理
- 月次請求書の自動生成
- 超過料金の明細表示
- 使用量レポート機能

## UI/UX設計

### ダッシュボード表示
```
┌─────────────────────────────┐
│ 📊 使用状況（スタンダードプラン） │
├─────────────────────────────┤
│ チャット使用量: 67/100回     │
│ 残り: 33回（31%）           │
│ ■■■■■■■□□□            │
│                             │
│ アカウント: 12/15名         │
│ 残り: 3名                   │
└─────────────────────────────┘
```

### 制限時の表示
```
┌─────────────────────────────┐
│ ⚠️ 使用制限に達しました       │
├─────────────────────────────┤
│ 今月のチャット回数が上限に  │
│ 達しました。                │
│                             │
│ • プランアップグレード      │
│ • 来月まで待機              │
│ • 超過料金での継続利用      │
└─────────────────────────────┘
```

## 実装優先度

### Phase 1: 基本機能（高優先度）
1. 3プランのBillingSettings作成
2. チャット使用量カウント機能
3. 基本的な制限機能

### Phase 2: 高度な機能（中優先度）
1. プラン変更UI
2. 使用量ダッシュボード
3. 通知システム

### Phase 3: 最適化（低優先度）
1. 詳細レポート機能
2. 自動プラン推奨
3. API経由でのプラン管理

## セキュリティ考慮事項

### 使用量改ざん防止
- サーバーサイドでの厳密なカウント
- ログによる使用履歴の追跡
- 異常使用パターンの検知

### 料金計算の透明性
- 使用量の詳細ログ保存
- 請求根拠の明確化
- ユーザーによる使用履歴確認機能

## 運用方針

### 課金タイミング
- 月末締め、翌月10日請求
- 超過分は即座に計算・表示
- プラン変更は翌月から適用

### サポート対応
- プラン選択の相談対応
- 使用量最適化のアドバイス
- 技術的な問題のサポート

## 今後の拡張性

### 機能追加時の対応
- 新しいAI機能の追加
- 使用量単位の柔軟な変更
- 企業向けカスタムプラン

### スケーラビリティ
- 大量ユーザーでの使用量計算
- リアルタイム使用量更新
- 分散環境での一貫性保証 