# SSOT: エラーページ [DETAIL]

> 機能ID: ERR-001, ERR-003
> ステータス: Ready
> 最終更新: 2026-02-05
> 関連: SSOT-1 #ERR-001, #ERR-003, SSOT-2 #SCR-404, #SCR-500

**プロジェクト**: ミエルボード for 現場
**モジュール**: エラーハンドリングUI
**バージョン**: v1.0
**層**: DETAIL（Freeze 4） - 止まらないルール適用

---

## 1. 概要 (Overview)

本機能は、ユーザーがエラー状態に遭遇した際に適切なフィードバックを提供し、
アプリケーションの継続利用を促すためのエラーページを定義する。

**スコープ:**
- 対象: 404 Not Found、500 Internal Server Error
- 対象外: 401/403（既存のログインリダイレクトで対応済み）、ネットワークエラー

---

## 2. ユーザーストーリー (User Stories)

### US-001: 404 Not Found
**As a** ユーザー
**I want** 存在しないページにアクセスした際に分かりやすいエラーページを見たい
**So that** 正しいページに戻れる

**受入条件:**
- [x] AC1: 存在しないURLアクセス時に専用404ページを表示
- [x] AC2: 404ページからトップ（ログインまたはダッシュボード）へのリンクが機能する
- [x] AC3: エラーコード（404）が明示される
- [x] AC4: モバイルでも適切に表示される

### US-002: 500 Internal Server Error
**As a** ユーザー
**I want** サーバーエラー発生時に状況を理解できるページを見たい
**So that** 再試行や問い合わせができる

**受入条件:**
- [x] AC1: サーバーエラー発生時に専用500ページを表示
- [x] AC2: エラー詳細はユーザーに公開せず、内部ログにのみ記録
- [x] AC3: 「再試行」ボタンまたは「トップへ戻る」リンクが機能する
- [x] AC4: モバイルでも適切に表示される

---

## 3. 画面仕様 (UI Specification)

### 3.1 共通レイアウト

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│              ┌─────────────────────┐               │
│              │   エラーアイコン    │               │
│              └─────────────────────┘               │
│                                                     │
│              エラーコード (404 / 500)               │
│                                                     │
│              エラーメッセージ                        │
│              （日本語で分かりやすく）                │
│                                                     │
│              ┌─────────────────────┐               │
│              │   トップへ戻る     │               │
│              └─────────────────────┘               │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 3.2 404 Not Found ページ

| 要素 | 内容 |
|------|------|
| アイコン | 検索/迷子のイメージ（絵文字 or SVG） |
| コード | `404` |
| タイトル | ページが見つかりません |
| 説明 | お探しのページは存在しないか、移動した可能性があります。 |
| ボタン | トップページへ戻る |

### 3.3 500 Internal Server Error ページ

| 要素 | 内容 |
|------|------|
| アイコン | エラー/警告のイメージ（絵文字 or SVG） |
| コード | `500` |
| タイトル | サーバーエラーが発生しました |
| 説明 | 申し訳ございません。しばらく時間をおいて再度お試しください。 |
| ボタン1 | 再試行（ページリロード） |
| ボタン2 | トップページへ戻る |

### 3.4 状態

| 状態 | 表示内容 |
|------|----------|
| 404 | 404エラーページ |
| 500 | 500エラーページ |
| その他 | 汎用エラーページ（500と同様） |

---

## 4. API仕様 (API Specification)

エラーページはクライアントサイドのみで完結するため、専用APIは不要。
Nuxt3 の `error.vue` でエラー情報を受け取り表示する。

**エラーオブジェクト構造:**
```typescript
interface NuxtError {
  statusCode: number
  statusMessage?: string
  message?: string
  data?: unknown
}
```

---

## 5. データモデル (Data Model)

エラーページ専用のデータモデルは不要。
500エラー発生時のログは既存の `AuditLog` または `console.error` で記録。

---

## 6. ビジネスロジック (Business Logic)

### 6.1 エラータイプ判定

```typescript
function getErrorType(statusCode: number): 'not-found' | 'server-error' | 'unknown' {
  if (statusCode === 404) return 'not-found'
  if (statusCode >= 500) return 'server-error'
  return 'unknown'
}
```

### 6.2 リダイレクト先判定

```typescript
function getRedirectPath(): string {
  // 認証状態に応じてリダイレクト先を変更
  const auth = useAuth()
  if (auth.isAuthenticated && auth.organization) {
    return `/org/${auth.organization.slug}/weekly-board`
  }
  return '/login'
}
```

---

## 7. エラーハンドリング (Error Handling)

- エラーページ自体でエラーが発生した場合は、最小限のHTML fallback を表示
- JavaScript無効環境でも基本的なエラーメッセージが表示されるよう `<noscript>` 対応

---

## 8. セキュリティ (Security)

- 500エラー時にスタックトレースやサーバー内部情報を公開しない
- エラーメッセージはユーザーフレンドリーな汎用文言のみ
- 認証状態に応じたリダイレクト先の適切な選択

---

## 9. パフォーマンス (Performance)

- エラーページは軽量に保つ（外部ライブラリ最小限）
- 画像はインラインSVGまたは絵文字を使用（追加リクエスト削減）

---

## 10. テストケース (Test Cases)

### TC-001: 404ページ表示
- **前提条件:** アプリケーションが起動している
- **操作:** `/nonexistent-page-xyz` にアクセス
- **期待結果:** 404エラーページが表示される
- **優先度:** P0

### TC-002: 404からトップへ戻る
- **前提条件:** 404ページが表示されている
- **操作:** 「トップページへ戻る」をクリック
- **期待結果:** ログインページまたはダッシュボードへ遷移
- **優先度:** P0

### TC-003: 500ページ表示
- **前提条件:** サーバーエラーが発生する状況
- **操作:** エラーを発生させるAPIを呼び出す
- **期待結果:** 500エラーページが表示される
- **優先度:** P0

### TC-004: 500から再試行
- **前提条件:** 500ページが表示されている
- **操作:** 「再試行」をクリック
- **期待結果:** ページがリロードされる
- **優先度:** P1

### TC-005: モバイル表示
- **前提条件:** モバイルビューポート
- **操作:** 404/500ページを表示
- **期待結果:** レスポンシブで適切に表示される
- **優先度:** P1

---

## 11. 実装メモ (Implementation Notes)

### 11.1 ファイル構成

| ファイル | 役割 |
|---------|------|
| `error.vue` | Nuxt3 グローバルエラーページ（ルート直下） |

### 11.2 Nuxt3 エラーページ仕様

- `error.vue` はルートディレクトリに配置（`pages/` ではない）
- `useError()` でエラー情報を取得
- `clearError()` でエラーをクリアしてナビゲーション

### 11.3 デザイン統一

- ログインページと同じ配色・フォント・ボーダー半径を使用
- 背景: `linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)`
- カード背景: `white`、角丸: `16px`

---

## 12. 未決事項 (Open Issues)

| ID | 内容 | ステータス | 期限 |
|----|------|-----------|------|
| - | なし | - | - |

---

## 変更履歴

| 日付 | 変更内容 | 変更者 |
|------|---------|-------|
| 2026-02-05 | 新規作成（12セクション形式） | AI（Claude Code） |
