# Tag Commands - タグ方式コマンド

**プロジェクト**: ミエルボード for 現場 / 現場WEEK  
**最終更新**: 2025-12-07

---

## 🎯 タグ方式とは

**会話ベースの開発フローに「軽量コマンド」を埋め込む**ことで、以下を一貫したインターフェースで扱えるようにする仕組みです：

- SSOT作成
- 実装着手
- バグ修正
- 進捗確認／次タスク選定
- プロンプト生成

---

## 📋 基本コンセプト

### 1. `>>` で始まるタグコマンド

- **通常会話**と区別できるよう、先頭に `>>` を付ける
- 「どの種類の仕事をさせたいか」をタグで明示
- 後続のフロー（SSOT参照・Plane参照・ガードレール適用など）を半自動で決める

### 2. タグは「AIの挙動プリセット」

- タグなし = 自由なディスカッション・設計相談
- タグあり = 機械的ワークフローを起動

### 3. 外部システム（Plane）を「唯一の進捗ソース」として紐付け

- 進捗やスコープ判断が必要なタグは、必ず Plane API 経由で Issue 状態を取得
- SSOT内の「実装状況」テキストは進捗根拠に使わない

---

## 🏷️ タグ一覧

| タグ | 用途 | フェーズ |
|------|------|---------|
| `>> write` | SSOT新規作成 | 仕様作成 |
| `>> impl` | SSOT実装 | 実装 |
| `>> fix` | バグ修正 | 修正 |
| `>> rfv` | SSOT実装検証 | 検証 |
| `>> next` | 次タスク選定 | タスク管理 |
| `>> prmt` | プロンプト生成 | 実装準備 |

---

## 📖 タグ詳細仕様

### `>> write` - SSOT新規作成

#### 概要

新しいSSOTドキュメントを作成します。

#### 入力例

```
>> write SSOT_GENBA_STOCK
```

#### 振る舞い（フロー）

```
1. 調査フェーズ
   ├─ 既存SSOT（docs/SSOT_GENBA_WEEK.md 等）を参照
   ├─ 関連する実装コードをスキャン
   └─ 類似ドメインの仕様を確認

2. ドラフト作成フェーズ
   ├─ SSOTテンプレートに沿って構成
   ├─ ブランド三層構造を意識
   ├─ スキーマ変更は原則禁止（例外: 管理AI承認 + 影響範囲修正が揃う場合のみ）・マルチテナント原則を反映
   └─ Phase分けと拡張方針を明記

3. 品質チェックフェーズ
   ├─ セルフレビュー（必要なら品質チェックリスト参照）
   ├─ 既存SSOTとの整合性確認
   └─ ユーザーレビュー依頼

4. 統合フェーズ
   └─ docs/INDEX_WEAK_CURRENT.md に追記
```

#### 制約

- ✅ スキーマ変更は原則禁止（例外あり）。可能なら `Schedule.metadata` 等で拡張を検討
- ✅ マルチテナント原則を前提
- ✅ 既存SSOTとの整合性を必ず確認

#### 出力

- `docs/SSOT_{モジュール名}.md` ファイル
- `docs/INDEX_WEAK_CURRENT.md` の更新

---

### `>> impl` - SSOT実装

#### 概要

SSOTに基づいて実装を行います。

#### 入力例

```
>> impl SSOT_GENBA_WEEK
```

または、特定の要件IDを指定：

```
>> impl SSOT_GENBA_WEEK P0-1.2
```

#### 振る舞い（フロー）

```
1. SSOT読了フェーズ
   ├─ 該当SSOTを最後まで読む
   ├─ 要件IDを抽出
   └─ Accept条件を確認

2. 既存実装スキャンフェーズ
   ├─ server/api/ 配下をスキャン
   ├─ components/ 配下をスキャン
   ├─ 既存実装の有無を確認
   └─ 依存関係を整理

3. 実装プラン提示フェーズ
   ├─ Item/Step構造でプランを提示
   ├─ 影響範囲を明示
   └─ ユーザー承認待ち ← **ここで必ず停止**

4. 実装フェーズ（承認後）
   ├─ SSOT準拠のコード実装
   ├─ requireAuth() / organizationId フィルタ適用
   ├─ Prisma ORMのみ使用
   └─ リアルタイム更新（Socket.IO）実装

5. テストフェーズ
   ├─ docs/TEST_STRATEGY.md 参照
   ├─ 必須レベルのテスト作成
   └─ Evidence（コマンド+ログ）取得

6. 完了フェーズ
   ├─ Plane Issue 更新（可能なら）
   └─ ユーザーに完了報告
```

#### 制約

- ✅ 実装前に必ずSSOTを**最後まで読む**
- ✅ ユーザー承認なしに実装フェーズに進まない
- ✅ `requireAuth()` / `organizationId` フィルタ必須
- ✅ 生SQL禁止
- ❌ スキーマ変更の無承認実施（例外: 管理AI承認 + 影響範囲修正が揃う場合のみ）

#### 出力

- 実装コード（`server/api/`, `components/` など）
- テストコード（`*.test.ts`）
- Evidence（実行ログ）

---

### `>> fix` - バグ修正

#### 概要

SSOT準拠の観点からバグを修正します。

#### 入力例

```
>> fix SSOT_GENBA_WEEK スケジュール削除エラー
```

#### 振る舞い（フロー）

```
1. SSOT照合フェーズ
   ├─ 該当SSOTを読み込み
   ├─ 現行実装を確認
   └─ 「どこがSSOTと矛盾しているか」を整理

2. 原因調査フェーズ（15分以内）
   ├─ エラーログを確認
   ├─ コードトレース
   ├─ データベース状態確認
   └─ 15分以内に特定できない場合 → 停止して報告

3. 修正方針提示フェーズ
   ├─ 根本原因の説明
   ├─ 修正方針を提示
   └─ ユーザー承認待ち ← **ここで必ず停止**

4. 修正フェーズ（承認後）
   ├─ 最小限の修正
   ├─ SSOT準拠を維持
   └─ スキーマ変更なし

5. テスト・検証フェーズ
   ├─ 修正内容のテスト
   ├─ リグレッション確認
   └─ Evidence取得

6. 完了フェーズ
   ├─ Plane Issue 更新
   └─ ユーザーに完了報告
```

#### 制約

- ✅ Implementation Halt Protocol を前提
- ✅ 原因特定できない場合は停止
- ✅ 「闇雲に直す」のを防ぐ
- ❌ スキーマ変更で解決しない

#### 出力

- 修正コード
- テスト結果
- Evidence（修正前後の動作ログ）

---

### `>> rfv` - SSOT実装検証（Review）

#### 概要

SSOTと実装のカバレッジ・ギャップを可視化します。

#### 入力例

```
>> rfv SSOT_GENBA_WEEK
```

#### 振る舞い（フロー）

```
1. SSOT読了フェーズ
   ├─ 該当SSOTを読み込み
   └─ 要件ID一覧を抽出

2. コードスキャンフェーズ
   ├─ server/api/ 配下をスキャン
   ├─ components/ 配下をスキャン
   └─ 各要件IDに対応するコードを特定

3. カバレッジ分析フェーズ
   ├─ 実装済み要件をリストアップ
   ├─ 未実装要件をリストアップ
   └─ 部分実装要件をリストアップ

4. レポート生成フェーズ
   ├─ Markdown形式でレポート作成
   ├─ カバレッジ率を計算
   └─ 次アクションを提案
```

#### 重要な注意事項

⚠️ **このタグは「仕様 vs 実装の差分」確認用**

- ✅ SSOT準拠度を可視化する
- ❌ **進捗の正はあくまで Plane**（このタグの結果を進捗根拠にしない）

#### 出力

- カバレッジレポート（チャット内 or `reports/` に保存）
- 未実装要件一覧
- 推奨アクション

---

### `>> next` - 次タスク選定

#### 概要

Planeから次に着手すべきIssueを選定します。

#### 入力例

```
>> next
```

#### 振る舞い（フロー）

```
1. Plane API 呼び出しフェーズ
   ├─ scripts/plane-lib/list-issues.cjs 実行
   ├─ 全Issue一覧を取得
   └─ 現在の State（Backlog / In Progress / Done）を確認

2. 分析フェーズ
   ├─ 依存関係を確認
   ├─ Phase（0 / 1 / 2）を確認
   ├─ 優先度（High / Medium / Low）を確認
   └─ ブロック状態を確認

3. 候補提示フェーズ
   ├─ 「今着手すべき Issue」を提案（1〜3件）
   ├─ 理由を説明
   └─ ユーザー承認待ち ← **ここで必ず停止**

4. Issue更新フェーズ（承認後）
   ├─ 選択されたIssueを "In Progress" に更新
   └─ ユーザーに確認
```

#### 制約

- ✅ AIが勝手にタスクを選ばない
- ✅ Planeの状態に沿ったロードマップ運用を強制
- ✅ ユーザー承認必須

#### 出力

- 次に着手すべきIssue（WBS-XX）
- 選定理由
- Plane Issue の State 更新

---

### `>> prmt` - プロンプト生成

#### 概要

実装AI向けの詳細プロンプトを生成します。

#### 入力例

```
>> prmt WBS-12
```

#### 振る舞い（フロー）

```
1. Plane Issue 取得フェーズ
   ├─ Plane API経由で Issue詳細を取得
   ├─ タイトル・説明・Accept条件を確認
   └─ 関連するSSOTを特定

2. SSOT読了フェーズ
   ├─ 関連SSOTを読み込み
   ├─ 要件ID・Accept条件を抽出
   └─ 制約事項を確認

3. プロンプト生成フェーズ
   ├─ Item/Step構造で実装手順を明記
   ├─ Evidence要件を明記
   ├─ 停止トリガー（Implementation Halt Protocol）を明記
   ├─ テスト戦略を明記
   └─ DoD（完了の定義）を明記

4. 出力フェーズ
   └─ チャット内にプロンプトを表示（コピペ用）
```

#### 制約

- ✅ **プロンプトはファイル保存しない**（Docs化禁止）
- ✅ 一時的な作業指示であり、SSOTとは別レイヤー
- ✅ コピペ運用

#### 出力

- 実装AI用プロンプト（チャット内のみ）

---

## 🔄 タグ方式の運用ルール

### 1. タグは「フェーズ切り替えスイッチ」

| フェーズ | タグ |
|---------|------|
| 仕様作成 | `>> write` |
| 実装 | `>> impl` |
| 修正 | `>> fix` |
| 検証 | `>> rfv` |
| タスク選定 | `>> next` |
| プロンプト生成 | `>> prmt` |

---

### 2. タグごとに「標準フロー」が決まっている

各タグは、明確な開始条件・フロー・終了条件を持ちます。

---

### 3. 進捗の正は Plane

- `>> next` / `>> prmt` / `>> impl` など、進捗やスコープ判断が必要なタグは、必ず **Plane API 経由で Issue 状態を取得**
- **SSOT内の「実装状況」テキストは進捗根拠に使わない**

---

### 4. 通常会話との分離

| 状況 | 使い方 |
|------|--------|
| **設計相談・質問・ディスカッション** | タグなし（通常会話） |
| **機械的ワークフロー起動** | `>>` 付きタグ |

---

## 📊 フェーズ別タグ使用例

### Phase 0（設計段階）

```
>> write SSOT_GENBA_STOCK
>> rfv SSOT_GENBA_WEEK
>> next
```

---

### Phase 1（実装段階）

```
>> next
>> prmt WBS-12
>> impl SSOT_GENBA_WEEK P0-1.2
>> rfv SSOT_GENBA_WEEK
```

---

### Phase 2（運用段階）

```
>> next
>> fix SSOT_GENBA_WEEK スケジュール削除エラー
>> rfv SSOT_GENBA_WEEK
```

---

## 🔗 関連ドキュメント

- `.cursorrules` - AI制御ルール（タグ方式の概要）
- `docs/SSOT_GENBA_WEEK.md` - 設計SSOT
- `docs/QUALITY_MANAGEMENT_OVERVIEW.md` - 品質管理の全体像
- `docs/DONE_DEFINITION.md` - 完了の定義
- `docs/TEST_STRATEGY.md` - テスト戦略

---

**タグ方式は、AI駆動開発における「曖昧さ」を減らし、一貫したワークフローを実現します。**




