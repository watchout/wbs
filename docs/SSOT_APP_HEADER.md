# SSOT: 共通ヘッダー・設定メニュー

**プロジェクト**: ミエルボード for 現場  
**モジュール**: 共通UI・ナビゲーション  
**バージョン**: v1.0  
**最終更新**: 2026-01-23  
**ステータス**: 実装済み

---

## 🎯 このドキュメントの位置づけ

このドキュメントは **共通ヘッダー・設定メニューの設計における唯一の正（Single Source of Truth）** です。

全ページで共通して使用するナビゲーションヘッダーと、権限に応じた設定・管理メニューを定義します。

---

## 1. 背景・課題

### 1-1. 現状の問題

| 問題ID | 内容 |
|--------|------|
| P-01 | ユーザーが自分のプロフィールやパスワードを変更する導線がない |
| P-02 | 管理画面への遷移が直接URL入力のみで発見しにくい |
| P-03 | ログイン中のユーザー情報（名前・権限）が画面上で確認できない |
| P-04 | ログアウト導線が不明確 |

### 1-2. 解決方針

すべてのページに共通ヘッダーを配置し、権限に応じたメニューを表示する。

---

## 2. 機能概要

### 2-1. 対象機能一覧

| ID | 機能名 | 概要 | 優先度 |
|----|--------|------|--------|
| HDR-01 | 共通ヘッダー | 全ページ共通のナビゲーションバー | P0 |
| HDR-02 | ユーザーメニュー | ログイン中ユーザー情報とドロップダウン | P0 |
| HDR-03 | 設定メニュー | 全ユーザー向け設定項目 | P0 |
| HDR-04 | 管理メニュー | ADMIN向け管理項目 | P0 |
| HDR-05 | プロフィール設定画面 | 名前変更 | P1 |
| HDR-06 | パスワード変更画面 | パスワード変更 | P1 |

---

## 3. HDR-01: 共通ヘッダー

### 3-1. 要件

| 要件ID | 内容 | ステータス |
|--------|------|----------|
| HDR-01-001 | ヘッダーは全ページの上部に固定表示 | ✅ 実装済み |
| HDR-01-002 | 左側にロゴ（ホームへのリンク） | ✅ 実装済み |
| HDR-01-003 | 中央にメインナビゲーション（週間ボード、日程調整） | ✅ 実装済み |
| HDR-01-004 | 右側にユーザーメニュー | ✅ 実装済み |
| HDR-01-005 | 未ログイン時は「ログイン」リンクのみ表示 | ✅ 実装済み |
| HDR-01-006 | ロゴ表示を「ミエルボード」に変更（製品名） | ✅ 実装済み |
| HDR-01-007 | 製品切り替えドロップダウン（ミエルボード/ストック/ドライブ） | ✅ 実装済み |
| HDR-01-008 | ロゴ右側に「powered by ミエルプラス」（小文字）を表示 | ✅ 実装済み |

### 3-2. レイアウト

```
┌────────────────────────────────────────────────────────────────────────────────┐
│ [M] ミエルボード ▼ powered by ミエルプラス  [週間ボード] [日程調整]  [ユーザー▼] │
└────────────────────────────────────────────────────────────────────────────────┘
```

### 3-3. 製品切り替えドロップダウン

| 製品名 | 遷移先URL | 備考 |
|--------|-----------|------|
| ミエルボード | /org/{slug}/weekly-board | 現在の製品（アクティブ表示） |
| ミエルストック | /products/stock | 仮LP（未実装時は `/` へ） |
| ミエルドライブ | /products/drive | 仮LP（未実装時は `/` へ） |

### 3-3. コンポーネント構成

```
layouts/
└── default.vue           # デフォルトレイアウト（ヘッダー含む）

components/
└── common/
    └── AppHeader.vue     # 共通ヘッダーコンポーネント
```

---

## 4. HDR-02: ユーザーメニュー

### 4-1. 要件

| 要件ID | 内容 | ステータス |
|--------|------|----------|
| HDR-02-001 | ユーザー名と権限バッジを表示 | ✅ 実装済み |
| HDR-02-002 | クリックでドロップダウンメニューを開閉 | ✅ 実装済み |
| HDR-02-003 | メニュー外クリックで閉じる | ✅ 実装済み |

### 4-2. 権限バッジ表示

| Role | 表示名 |
|------|--------|
| SUPER_ADMIN | 最高管理者 |
| ADMIN | 管理者 |
| LEADER | リーダー |
| MEMBER | 一般 |

---

## 5. HDR-03: 設定メニュー（全ユーザー共通）

### 5-1. 要件

| 要件ID | 内容 | ステータス |
|--------|------|----------|
| HDR-03-001 | 「設定」セクションヘッダーを表示 | ✅ 実装済み |
| HDR-03-002 | プロフィール設定リンク | ✅ 実装済み |
| HDR-03-003 | パスワード変更リンク | ✅ 実装済み |
| HDR-03-004 | ログアウトボタン | ✅ 実装済み |

### 5-2. メニュー構成

```
┌─────────────────────────┐
│ 設定                     │
│ ├─ 👤 プロフィール        │
│ └─ 🔑 パスワード変更      │
├─────────────────────────┤
│ 🚪 ログアウト            │
└─────────────────────────┘
```

---

## 6. HDR-04: 管理メニュー（ADMINのみ）

### 6-1. 要件

| 要件ID | 内容 | ステータス |
|--------|------|----------|
| HDR-04-001 | ADMIN/SUPER_ADMINのみ「管理」セクション表示 | ✅ 実装済み |
| HDR-04-002 | ユーザー管理リンク（/admin/users） | ✅ 実装済み |
| HDR-04-003 | 部署管理リンク（/admin/departments） | ✅ 実装済み |

### 6-2. メニュー構成（ADMIN時）

```
┌─────────────────────────┐
│ 設定                     │
│ ├─ 👤 プロフィール        │
│ └─ 🔑 パスワード変更      │
├─────────────────────────┤
│ 管理                     │ ← ADMINのみ表示
│ ├─ 👥 ユーザー管理        │
│ └─ 🏢 部署管理           │
├─────────────────────────┤
│ 🚪 ログアウト            │
└─────────────────────────┘
```

---

## 7. HDR-05: プロフィール設定画面

### 7-1. 要件

| 要件ID | 内容 | ステータス |
|--------|------|----------|
| HDR-05-001 | URL: /settings/profile | ✅ 実装済み |
| HDR-05-002 | 名前を編集可能 | ✅ 実装済み |
| HDR-05-003 | メールアドレスは読み取り専用で表示 | ✅ 実装済み |
| HDR-05-004 | 権限は読み取り専用で表示 | ✅ 実装済み |
| HDR-05-005 | 所属部署は読み取り専用で表示 | ✅ 実装済み |

### 7-2. API

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| /api/users/me | PATCH | 自分のプロフィール更新 |
| /api/auth/me | GET | 自分の情報取得（既存） |

### 7-3. /api/users/me PATCH仕様

**リクエスト**:
```json
{
  "name": "新しい名前"
}
```

**レスポンス**:
```json
{
  "success": true,
  "user": {
    "id": "...",
    "name": "新しい名前",
    "email": "..."
  }
}
```

---

## 8. HDR-06: パスワード変更画面

### 8-1. 要件

| 要件ID | 内容 | ステータス |
|--------|------|----------|
| HDR-06-001 | URL: /settings/password | ✅ 実装済み |
| HDR-06-002 | 現在のパスワード入力必須 | ✅ 実装済み |
| HDR-06-003 | 新しいパスワード入力（8文字以上） | ✅ 実装済み |
| HDR-06-004 | 新しいパスワード確認入力 | ✅ 実装済み |
| HDR-06-005 | パスワード不一致時はエラー表示 | ✅ 実装済み |

### 8-2. API

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| /api/auth/change-password | POST | パスワード変更（既存） |

---

## 9. 実装ファイル一覧

### 9-1. 新規作成

| ファイル | 説明 |
|---------|------|
| layouts/default.vue | デフォルトレイアウト |
| components/common/AppHeader.vue | 共通ヘッダー |
| pages/settings/profile.vue | プロフィール設定 |
| pages/settings/password.vue | パスワード変更 |
| server/api/users/me.patch.ts | プロフィール更新API |

### 9-2. 変更

| ファイル | 変更内容 |
|---------|---------|
| server/api/auth/me.get.ts | departmentを含めて返す |

---

## 10. モバイル対応

### 10-1. 要件

| 要件ID | 内容 | ステータス |
|--------|------|----------|
| HDR-M-001 | 768px以下でメインナビゲーション非表示 | ✅ 実装済み |
| HDR-M-002 | 480px以下でユーザー名非表示（アイコンのみ） | ✅ 実装済み |

---

## 11. テスト要件

### 11-1. 必須テスト

| テストID | 内容 | 種別 |
|---------|------|------|
| T-HDR-001 | 未ログイン時はログインリンクのみ表示 | Unit |
| T-HDR-002 | MEMBER権限で管理メニュー非表示 | Unit |
| T-HDR-003 | ADMIN権限で管理メニュー表示 | Unit |
| T-HDR-004 | プロフィール更新APIは認証必須 | Integration |
| T-HDR-005 | プロフィール更新はマルチテナント境界を守る | Integration |

---

## 12. 関連ドキュメント

- [SSOT_MVP_EXTEND.md](./SSOT_MVP_EXTEND.md) - 管理画面拡張（AdminNav）
- [SSOT_GENBA_WEEK.md](./SSOT_GENBA_WEEK.md) - 認証・権限モデル
